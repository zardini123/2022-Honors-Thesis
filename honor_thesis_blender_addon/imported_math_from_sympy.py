from math import sqrt
from numpy import greater_equal

def umbilic(P, u, v):
    x0 = u**3
    x1 = v**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**3
    x6 = x2*x5
    x7 = 1 - v
    x8 = x7**2
    x9 = 3*x8
    x10 = x0*x9
    x11 = x4**2
    x12 = 9*x11
    x13 = x1*x12
    x14 = u*x13
    x15 = u**2
    x16 = 9*x15
    x17 = x1*x16
    x18 = x17*x4
    x19 = x5*x9
    x20 = x12*x8
    x21 = u*x20
    x22 = x16*x8
    x23 = x22*x4
    x24 = 6*v*x7 - x2
    x25 = x0*x24
    x26 = x24*x5
    x27 = 3*v
    x28 = x27*(2*v - 2) + x9
    x29 = x0*x28
    x30 = 3*x11
    x31 = x24*x30
    x32 = u*x31
    x33 = 3*x15
    x34 = x24*x33
    x35 = x34*x4
    x36 = x28*x5
    x37 = x28*x30
    x38 = u*x37
    x39 = x28*x33
    x40 = x39*x4
    x41 = -P[0][0].x*x19 + P[0][1].x*x36 + P[0][2].x*x26 + P[0][3].x*x6 - P[1][0].x*x21 + P[1][1].x*x38 + P[1][2].x*x32 + P[1][3].x*x14 - P[2][0].x*x23 + P[2][1].x*x40 + P[2][2].x*x35 + P[2][3].x*x18 - P[3][0].x*x10 + P[3][1].x*x29 + P[3][2].x*x25 + P[3][3].x*x3
    x42 = -P[0][0].y*x19 + P[0][1].y*x36 + P[0][2].y*x26 + P[0][3].y*x6 - P[1][0].y*x21 + P[1][1].y*x38 + P[1][2].y*x32 + P[1][3].y*x14 - P[2][0].y*x23 + P[2][1].y*x40 + P[2][2].y*x35 + P[2][3].y*x18 - P[3][0].y*x10 + P[3][1].y*x29 + P[3][2].y*x25 + P[3][3].y*x3
    x43 = -P[0][0].z*x19 + P[0][1].z*x36 + P[0][2].z*x26 + P[0][3].z*x6 - P[1][0].z*x21 + P[1][1].z*x38 + P[1][2].z*x32 + P[1][3].z*x14 - P[2][0].z*x23 + P[2][1].z*x40 + P[2][2].z*x35 + P[2][3].z*x18 - P[3][0].z*x10 + P[3][1].z*x29 + P[3][2].z*x25 + P[3][3].z*x3
    x44 = x41**2 + x42**2 + x43**2
    x45 = v**3
    x46 = 6*u
    x47 = x45*x46
    x48 = 6*x4
    x49 = x45*x48
    x50 = 3*u
    x51 = x50 - 2
    x52 = 6*x51
    x53 = x45*x52
    x54 = 1 - x50
    x55 = 6*x54
    x56 = x45*x55
    x57 = x7**3
    x58 = x46*x57
    x59 = v*x8
    x60 = 18*u
    x61 = x59*x60
    x62 = x1*x7
    x63 = x60*x62
    x64 = x48*x57
    x65 = x52*x57
    x66 = x55*x57
    x67 = 18*x4
    x68 = x59*x67
    x69 = x62*x67
    x70 = 18*x51
    x71 = x59*x70
    x72 = x62*x70
    x73 = 18*x54
    x74 = x59*x73
    x75 = x62*x73
    x76 = x33*x45
    x77 = x30*x45
    x78 = x33*x57
    x79 = v*x22
    x80 = x17*x7
    x81 = x30*x57
    x82 = v*x20
    x83 = x13*x7
    x84 = 6*u*x4 - x33
    x85 = x45*x84
    x86 = x30 + x50*(2*u - 2)
    x87 = x45*x86
    x88 = x57*x84
    x89 = x84*x9
    x90 = v*x89
    x91 = x2*x84
    x92 = x7*x91
    x93 = x57*x86
    x94 = x86*x9
    x95 = v*x94
    x96 = x2*x86
    x97 = x7*x96
    x98 = -P[0][0].x*x81 - P[0][1].x*x82 - P[0][2].x*x83 - P[0][3].x*x77 + P[1][0].x*x93 + P[1][1].x*x95 + P[1][2].x*x97 + P[1][3].x*x87 + P[2][0].x*x88 + P[2][1].x*x90 + P[2][2].x*x92 + P[2][3].x*x85 + P[3][0].x*x78 + P[3][1].x*x79 + P[3][2].x*x80 + P[3][3].x*x76
    x99 = -P[0][0].y*x81 - P[0][1].y*x82 - P[0][2].y*x83 - P[0][3].y*x77 + P[1][0].y*x93 + P[1][1].y*x95 + P[1][2].y*x97 + P[1][3].y*x87 + P[2][0].y*x88 + P[2][1].y*x90 + P[2][2].y*x92 + P[2][3].y*x85 + P[3][0].y*x78 + P[3][1].y*x79 + P[3][2].y*x80 + P[3][3].y*x76
    x100 = -x41*x99 + x42*x98
    x101 = -P[0][0].z*x81 - P[0][1].z*x82 - P[0][2].z*x83 - P[0][3].z*x77 + P[1][0].z*x93 + P[1][1].z*x95 + P[1][2].z*x97 + P[1][3].z*x87 + P[2][0].z*x88 + P[2][1].z*x90 + P[2][2].z*x92 + P[2][3].z*x85 + P[3][0].z*x78 + P[3][1].z*x79 + P[3][2].z*x80 + P[3][3].z*x76
    x102 = x101*x41 - x43*x98
    x103 = -x101*x42 + x43*x99
    x104 = 1/sqrt(x100**2 + x102**2 + x103**2)
    x105 = x100*x104
    x106 = x102*x104
    x107 = x103*x104
    x108 = x105*(P[0][0].z*x64 + P[0][1].z*x68 + P[0][2].z*x69 + P[0][3].z*x49 + P[1][0].z*x65 + P[1][1].z*x71 + P[1][2].z*x72 + P[1][3].z*x53 + P[2][0].z*x66 + P[2][1].z*x74 + P[2][2].z*x75 + P[2][3].z*x56 + P[3][0].z*x58 + P[3][1].z*x61 + P[3][2].z*x63 + P[3][3].z*x47) + x106*(P[0][0].y*x64 + P[0][1].y*x68 + P[0][2].y*x69 + P[0][3].y*x49 + P[1][0].y*x65 + P[1][1].y*x71 + P[1][2].y*x72 + P[1][3].y*x53 + P[2][0].y*x66 + P[2][1].y*x74 + P[2][2].y*x75 + P[2][3].y*x56 + P[3][0].y*x58 + P[3][1].y*x61 + P[3][2].y*x63 + P[3][3].y*x47) + x107*(P[0][0].x*x64 + P[0][1].x*x68 + P[0][2].x*x69 + P[0][3].x*x49 + P[1][0].x*x65 + P[1][1].x*x71 + P[1][2].x*x72 + P[1][3].x*x53 + P[2][0].x*x66 + P[2][1].x*x74 + P[2][2].x*x75 + P[2][3].x*x56 + P[3][0].x*x58 + P[3][1].x*x61 + P[3][2].x*x63 + P[3][3].x*x47)
    x109 = x101**2 + x98**2 + x99**2
    x110 = 6*x0
    x111 = v*x110
    x112 = 6*x5
    x113 = v*x112
    x114 = 6*x7
    x115 = x0*x114
    x116 = x27 - 2
    x117 = x110*x116
    x118 = 1 - x27
    x119 = x110*x118
    x120 = x11*x60
    x121 = v*x120
    x122 = x15*x67
    x123 = v*x122
    x124 = x114*x5
    x125 = x112*x116
    x126 = x112*x118
    x127 = x120*x7
    x128 = x116*x120
    x129 = x118*x120
    x130 = x122*x7
    x131 = x116*x122
    x132 = x118*x122
    x133 = x105*(P[0][0].z*x124 + P[0][1].z*x125 + P[0][2].z*x126 + P[0][3].z*x113 + P[1][0].z*x127 + P[1][1].z*x128 + P[1][2].z*x129 + P[1][3].z*x121 + P[2][0].z*x130 + P[2][1].z*x131 + P[2][2].z*x132 + P[2][3].z*x123 + P[3][0].z*x115 + P[3][1].z*x117 + P[3][2].z*x119 + P[3][3].z*x111) + x106*(P[0][0].y*x124 + P[0][1].y*x125 + P[0][2].y*x126 + P[0][3].y*x113 + P[1][0].y*x127 + P[1][1].y*x128 + P[1][2].y*x129 + P[1][3].y*x121 + P[2][0].y*x130 + P[2][1].y*x131 + P[2][2].y*x132 + P[2][3].y*x123 + P[3][0].y*x115 + P[3][1].y*x117 + P[3][2].y*x119 + P[3][3].y*x111) + x107*(P[0][0].x*x124 + P[0][1].x*x125 + P[0][2].x*x126 + P[0][3].x*x113 + P[1][0].x*x127 + P[1][1].x*x128 + P[1][2].x*x129 + P[1][3].x*x121 + P[2][0].x*x130 + P[2][1].x*x131 + P[2][2].x*x132 + P[2][3].x*x123 + P[3][0].x*x115 + P[3][1].x*x117 + P[3][2].x*x119 + P[3][3].x*x111)
    x134 = x101*x43 + x41*x98 + x42*x99
    x135 = x24*x84
    x136 = x24*x86
    x137 = x28*x84
    x138 = x28*x86
    x139 = x105*(P[0][0].z*x20 - P[0][1].z*x37 - P[0][2].z*x31 - P[0][3].z*x13 - P[1][0].z*x94 + P[1][1].z*x138 + P[1][2].z*x136 + P[1][3].z*x96 - P[2][0].z*x89 + P[2][1].z*x137 + P[2][2].z*x135 + P[2][3].z*x91 - P[3][0].z*x22 + P[3][1].z*x39 + P[3][2].z*x34 + P[3][3].z*x17) + x106*(P[0][0].y*x20 - P[0][1].y*x37 - P[0][2].y*x31 - P[0][3].y*x13 - P[1][0].y*x94 + P[1][1].y*x138 + P[1][2].y*x136 + P[1][3].y*x96 - P[2][0].y*x89 + P[2][1].y*x137 + P[2][2].y*x135 + P[2][3].y*x91 - P[3][0].y*x22 + P[3][1].y*x39 + P[3][2].y*x34 + P[3][3].y*x17) + x107*(P[0][0].x*x20 - P[0][1].x*x37 - P[0][2].x*x31 - P[0][3].x*x13 - P[1][0].x*x94 + P[1][1].x*x138 + P[1][2].x*x136 + P[1][3].x*x96 - P[2][0].x*x89 + P[2][1].x*x137 + P[2][2].x*x135 + P[2][3].x*x91 - P[3][0].x*x22 + P[3][1].x*x39 + P[3][2].x*x34 + P[3][3].x*x17)
    return -(4*x108*x133 - 4*x139**2)*(x109*x44 - x134**2) + (x108*x44 + x109*x133 - 2*x134*x139)**2

def umbilic_u_derivative(P, u, v):
    x0 = u**3
    x1 = v**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**3
    x6 = x2*x5
    x7 = 1 - v
    x8 = x7**2
    x9 = 3*x8
    x10 = x0*x9
    x11 = x4**2
    x12 = 9*x11
    x13 = x1*x12
    x14 = P[1][3].x*x13
    x15 = u**2
    x16 = 9*x15
    x17 = x1*x16
    x18 = P[2][3].x*x17
    x19 = x5*x9
    x20 = x12*x8
    x21 = P[1][0].x*x20
    x22 = x16*x8
    x23 = P[2][0].x*x22
    x24 = 6*v*x7 - x2
    x25 = x0*x24
    x26 = x24*x5
    x27 = 3*v
    x28 = x27*(2*v - 2) + x9
    x29 = x0*x28
    x30 = 3*x11
    x31 = x24*x30
    x32 = P[1][2].x*x31
    x33 = 3*x15
    x34 = x24*x33
    x35 = P[2][2].x*x34
    x36 = x28*x5
    x37 = x28*x30
    x38 = P[1][1].x*x37
    x39 = x28*x33
    x40 = P[2][1].x*x39
    x41 = -P[0][0].x*x19 + P[0][1].x*x36 + P[0][2].x*x26 + P[0][3].x*x6 - P[3][0].x*x10 + P[3][1].x*x29 + P[3][2].x*x25 + P[3][3].x*x3 + u*x14 - u*x21 + u*x32 + u*x38 + x18*x4 - x23*x4 + x35*x4 + x4*x40
    x42 = P[1][3].y*x13
    x43 = P[2][3].y*x17
    x44 = P[1][0].y*x20
    x45 = P[2][0].y*x22
    x46 = P[1][2].y*x31
    x47 = P[2][2].y*x34
    x48 = P[1][1].y*x37
    x49 = P[2][1].y*x39
    x50 = -P[0][0].y*x19 + P[0][1].y*x36 + P[0][2].y*x26 + P[0][3].y*x6 - P[3][0].y*x10 + P[3][1].y*x29 + P[3][2].y*x25 + P[3][3].y*x3 + u*x42 - u*x44 + u*x46 + u*x48 + x4*x43 - x4*x45 + x4*x47 + x4*x49
    x51 = P[1][3].z*x13
    x52 = P[2][0].z*x22
    x53 = P[1][2].z*x31
    x54 = P[1][1].z*x37
    x55 = -P[0][0].z*x19 + P[0][1].z*x36 + P[0][2].z*x26 + P[0][3].z*x6 - P[1][0].z*u*x20 + P[2][1].z*x39*x4 + P[2][2].z*x34*x4 + P[2][3].z*x17*x4 - P[3][0].z*x10 + P[3][1].z*x29 + P[3][2].z*x25 + P[3][3].z*x3 + u*x51 + u*x53 + u*x54 - x4*x52
    x56 = x41**2 + x50**2 + x55**2
    x57 = v**3
    x58 = 12*u
    x59 = x57*x58
    x60 = 2*u - 2
    x61 = 6*x57
    x62 = P[0][3].x*x61
    x63 = 18*u
    x64 = x63 - 12
    x65 = x57*x64
    x66 = P[1][3].x*x65
    x67 = 6 - x63
    x68 = x57*x67
    x69 = P[2][3].x*x68
    x70 = x7**3
    x71 = x58*x70
    x72 = v*x8
    x73 = 36*u
    x74 = x72*x73
    x75 = x1*x7
    x76 = x73*x75
    x77 = 6*x70
    x78 = P[0][0].x*x77
    x79 = x64*x70
    x80 = P[1][0].x*x79
    x81 = x67*x70
    x82 = P[2][0].x*x81
    x83 = 18*x72
    x84 = P[0][1].x*x83
    x85 = 18*x75
    x86 = P[0][2].x*x85
    x87 = 6*x72
    x88 = x64*x87
    x89 = 6*x7
    x90 = x1*x89
    x91 = x64*x90
    x92 = x67*x87
    x93 = x67*x90
    x94 = x33*x57
    x95 = x30*x57
    x96 = x33*x70
    x97 = v*x22
    x98 = x17*x7
    x99 = x30*x70
    x100 = v*x20
    x101 = x13*x7
    x102 = 6*u*x4 - x33
    x103 = x102*x57
    x104 = 3*u
    x105 = x104*x60
    x106 = x105 + x30
    x107 = x106*x57
    x108 = x102*x70
    x109 = x102*x9
    x110 = v*x109
    x111 = x102*x2
    x112 = x111*x7
    x113 = x106*x70
    x114 = x106*x9
    x115 = v*x114
    x116 = x106*x2
    x117 = x116*x7
    x118 = -P[0][0].x*x99 - P[0][1].x*x100 - P[0][2].x*x101 - P[0][3].x*x95 + P[1][0].x*x113 + P[1][1].x*x115 + P[1][2].x*x117 + P[1][3].x*x107 + P[2][0].x*x108 + P[2][1].x*x110 + P[2][2].x*x112 + P[2][3].x*x103 + P[3][0].x*x96 + P[3][1].x*x97 + P[3][2].x*x98 + P[3][3].x*x94
    x119 = P[0][3].y*x61
    x120 = P[1][3].y*x65
    x121 = P[2][3].y*x68
    x122 = P[0][0].y*x77
    x123 = P[1][0].y*x79
    x124 = P[2][0].y*x81
    x125 = P[0][1].y*x83
    x126 = P[0][2].y*x85
    x127 = -P[0][0].y*x99 - P[0][1].y*x100 - P[0][2].y*x101 - P[0][3].y*x95 + P[1][0].y*x113 + P[1][1].y*x115 + P[1][2].y*x117 + P[1][3].y*x107 + P[2][0].y*x108 + P[2][1].y*x110 + P[2][2].y*x112 + P[2][3].y*x103 + P[3][0].y*x96 + P[3][1].y*x97 + P[3][2].y*x98 + P[3][3].y*x94
    x128 = P[0][3].z*x61
    x129 = P[1][3].z*x65
    x130 = P[2][3].z*x68
    x131 = P[0][0].z*x77
    x132 = P[1][0].z*x79
    x133 = P[2][0].z*x81
    x134 = P[0][1].z*x83
    x135 = P[0][2].z*x85
    x136 = -P[0][0].z*x99 - P[0][1].z*x100 - P[0][2].z*x101 - P[0][3].z*x95 + P[1][0].z*x113 + P[1][1].z*x115 + P[1][2].z*x117 + P[1][3].z*x107 + P[2][0].z*x108 + P[2][1].z*x110 + P[2][2].z*x112 + P[2][3].z*x103 + P[3][0].z*x96 + P[3][1].z*x97 + P[3][2].z*x98 + P[3][3].z*x94
    x137 = x118*(P[1][1].x*x88 + P[1][2].x*x91 + P[2][1].x*x92 + P[2][2].x*x93 + P[3][0].x*x71 + P[3][1].x*x74 + P[3][2].x*x76 + P[3][3].x*x59 - x60*x62 - x60*x78 - x60*x84 - x60*x86 + 2*x66 + 2*x69 + 2*x80 + 2*x82) + x127*(P[1][1].y*x88 + P[1][2].y*x91 + P[2][1].y*x92 + P[2][2].y*x93 + P[3][0].y*x71 + P[3][1].y*x74 + P[3][2].y*x76 + P[3][3].y*x59 - x119*x60 + 2*x120 + 2*x121 - x122*x60 + 2*x123 + 2*x124 - x125*x60 - x126*x60) + x136*(P[1][1].z*x88 + P[1][2].z*x91 + P[2][1].z*x92 + P[2][2].z*x93 + P[3][0].z*x71 + P[3][1].z*x74 + P[3][2].z*x76 + P[3][3].z*x59 - x128*x60 + 2*x129 + 2*x130 - x131*x60 + 2*x132 + 2*x133 - x134*x60 - x135*x60)
    x138 = x118**2 + x127**2 + x136**2
    x139 = 18*x15
    x140 = x1*x139
    x141 = x1*x63
    x142 = x141*x60
    x143 = x4*x73
    x144 = x1*x143
    x145 = 18*x11
    x146 = x1*x145
    x147 = x139*x8
    x148 = x63*x8
    x149 = x148*x60
    x150 = x143*x8
    x151 = x145*x8
    x152 = 6*x15
    x153 = x152*x24
    x154 = 6*u
    x155 = x154*x24
    x156 = x155*x60
    x157 = x4*x58
    x158 = x157*x24
    x159 = 6*x11
    x160 = x159*x24
    x161 = P[2][1].x*x28
    x162 = x152*x28
    x163 = x154*x28
    x164 = x163*x60
    x165 = x159*x28
    x166 = P[0][3].y*x1
    x167 = P[3][0].y*x8
    x168 = x157*x28
    x169 = P[0][1].y*x28
    x170 = x41*(P[0][0].x*x151 - P[0][1].x*x165 - P[0][2].x*x160 - P[0][3].x*x146 - P[1][0].x*x149 - P[1][0].x*x151 + P[1][1].x*x164 + P[1][1].x*x165 + P[1][2].x*x156 + P[1][2].x*x160 + P[1][3].x*x142 + P[1][3].x*x146 + P[2][0].x*x147 - P[2][0].x*x150 - P[2][2].x*x153 + P[2][2].x*x158 - P[2][3].x*x140 + P[2][3].x*x144 - P[3][0].x*x147 + P[3][1].x*x162 + P[3][2].x*x153 + P[3][3].x*x140 - x152*x161 + x157*x161) + x50*(P[0][0].y*x151 - P[0][2].y*x160 - P[1][0].y*x149 - P[1][0].y*x151 + P[1][1].y*x164 + P[1][1].y*x165 + P[1][2].y*x156 + P[1][2].y*x160 + P[1][3].y*x142 + P[1][3].y*x146 + P[2][0].y*x147 - P[2][0].y*x150 - P[2][1].y*x162 + P[2][1].y*x168 - P[2][2].y*x153 + P[2][2].y*x158 - P[2][3].y*x140 + P[2][3].y*x144 + P[3][1].y*x162 + P[3][2].y*x153 + P[3][3].y*x140 - x139*x167 - x145*x166 - x159*x169) + x55*(P[0][0].z*x151 - P[0][1].z*x165 - P[0][2].z*x160 - P[0][3].z*x146 - P[1][0].z*x149 - P[1][0].z*x151 + P[1][1].z*x164 + P[1][1].z*x165 + P[1][2].z*x156 + P[1][2].z*x160 + P[1][3].z*x142 + P[1][3].z*x146 + P[2][0].z*x147 - P[2][0].z*x150 - P[2][1].z*x162 + P[2][1].z*x168 - P[2][2].z*x153 + P[2][2].z*x158 - P[2][3].z*x140 + P[2][3].z*x144 - P[3][0].z*x147 + P[3][1].z*x162 + P[3][2].z*x153 + P[3][3].z*x140)
    x171 = x118*x41 + x127*x50 + x136*x55
    x172 = 3*x60
    x173 = x172*x70
    x174 = x172*x57
    x175 = 9*x60
    x176 = x175*x8
    x177 = v*x176
    x178 = x1*x175
    x179 = x178*x7
    x180 = x64*x9
    x181 = v*x180
    x182 = x2*x64
    x183 = x182*x7
    x184 = x67*x9
    x185 = v*x184
    x186 = x2*x67
    x187 = x186*x7
    x188 = v*x148
    x189 = x141*x7
    x190 = P[3][0].x*u*x77 + P[3][1].x*x188 + P[3][2].x*x189 + P[3][3].x*u*x61
    x191 = -P[0][0].x*x173 - P[0][1].x*x177 - P[0][2].x*x179 - P[0][3].x*x174 + P[1][1].x*x181 + P[1][2].x*x183 + P[2][1].x*x185 + P[2][2].x*x187 + x190 + x66 + x69 + x80 + x82
    x192 = x191*x41
    x193 = P[3][0].y*u*x77 + P[3][1].y*x188 + P[3][2].y*x189 + P[3][3].y*u*x61
    x194 = -P[0][0].y*x173 - P[0][1].y*x177 - P[0][2].y*x179 - P[0][3].y*x174 + P[1][1].y*x181 + P[1][2].y*x183 + P[2][1].y*x185 + P[2][2].y*x187 + x120 + x121 + x123 + x124 + x193
    x195 = x194*x50
    x196 = P[3][0].z*u*x77 + P[3][1].z*x188 + P[3][2].z*x189 + P[3][3].z*u*x61
    x197 = -P[0][0].z*x173 - P[0][1].z*x177 - P[0][2].z*x179 - P[0][3].z*x174 + P[1][1].z*x181 + P[1][2].z*x183 + P[2][1].z*x185 + P[2][2].z*x187 + x129 + x130 + x132 + x133 + x196
    x198 = x197*x55
    x199 = x148*x4
    x200 = u*x176
    x201 = x105*x28
    x202 = x105*x24
    x203 = 6*x4
    x204 = u*x203
    x205 = x204*x24
    x206 = u*x178
    x207 = x141*x4
    x208 = P[0][0].x*x20 - P[0][1].x*x37 - P[0][2].x*x31 - P[0][3].x*x13 - P[3][0].x*x22 + P[3][1].x*x39 + P[3][2].x*x34 + P[3][3].x*x17
    x209 = -P[1][0].x*x200 + P[1][1].x*x201 + P[1][2].x*x202 + P[1][3].x*x206 - P[2][0].x*x199 + P[2][2].x*x205 + P[2][3].x*x207 + x14 + x161*x204 - x18 + x208 - x21 + x23 + x32 - x35 + x38 - x40
    x210 = x118*x209
    x211 = x204*x28
    x212 = P[0][0].y*x20 - P[0][1].y*x37 - P[0][2].y*x31 - P[0][3].y*x13 + P[3][1].y*x39 + P[3][2].y*x34 + P[3][3].y*x17 - x16*x167
    x213 = -P[1][0].y*x200 + P[1][1].y*x201 + P[1][2].y*x202 + P[1][3].y*x206 - P[2][0].y*x199 + P[2][1].y*x211 + P[2][2].y*x205 + P[2][3].y*x207 + x212 + x42 - x43 - x44 + x45 + x46 - x47 + x48 - x49
    x214 = x127*x213
    x215 = P[0][0].z*x20 - P[0][1].z*x37 - P[0][2].z*x31 - P[0][3].z*x13 - P[3][0].z*x22 + P[3][1].z*x39 + P[3][2].z*x34 + P[3][3].z*x17
    x216 = -9*P[1][0].z*u*x60*x8 - 9*P[1][0].z*x11*x8 + P[1][1].z*x201 + P[1][2].z*x202 + P[1][3].z*x206 - 18*P[2][0].z*u*x4*x8 - 3*P[2][1].z*x15*x28 + P[2][1].z*x211 - 3*P[2][2].z*x15*x24 + P[2][2].z*x205 - 9*P[2][3].z*x1*x15 + P[2][3].z*x207 + x215 + x51 + x52 + x53 + x54
    x217 = x136*x216
    x218 = x106*x28
    x219 = x106*x24
    x220 = x102*x28
    x221 = x102*x24
    x222 = -P[1][0].z*x114 + P[1][1].z*x218 + P[1][2].z*x219 + P[1][3].z*x116 - P[2][0].z*x109 + P[2][1].z*x220 + P[2][2].z*x221 + P[2][3].z*x111 + x215
    x223 = -x41
    x224 = x118*x50 + x127*x223
    x225 = -x55
    x226 = x118*x225 + x136*x41
    x227 = -x50
    x228 = x127*x55 + x136*x227
    x229 = x224**2 + x226**2 + x228**2
    x230 = 1/sqrt(x229)
    x231 = x224*x230
    x232 = -P[1][0].y*x114 + P[1][1].y*x218 + P[1][2].y*x219 + P[1][3].y*x116 - P[2][0].y*x109 + P[2][1].y*x220 + P[2][2].y*x221 + P[2][3].y*x111 + x212
    x233 = x226*x230
    x234 = -P[1][0].x*x114 + P[1][1].x*x218 + P[1][2].x*x219 + P[1][3].x*x116 - P[2][0].x*x109 + P[2][1].x*x220 + P[2][2].x*x221 + P[2][3].x*x111 + x208
    x235 = x228*x230
    x236 = x222*x231 + x232*x233 + x234*x235
    x237 = x203*x70
    x238 = x203*x57
    x239 = x104 - 2
    x240 = x239*x77
    x241 = x239*x61
    x242 = 1 - x104
    x243 = x242*x77
    x244 = x242*x61
    x245 = x239*x83
    x246 = x239*x85
    x247 = x242*x83
    x248 = x242*x85
    x249 = P[0][0].z*x237 + P[0][3].z*x238 + P[1][0].z*x240 + P[1][1].z*x245 + P[1][2].z*x246 + P[1][3].z*x241 + P[2][0].z*x243 + P[2][1].z*x247 + P[2][2].z*x248 + P[2][3].z*x244 + x134*x4 + x135*x4 + x196
    x250 = P[0][0].y*x237 + P[0][3].y*x238 + P[1][0].y*x240 + P[1][1].y*x245 + P[1][2].y*x246 + P[1][3].y*x241 + P[2][0].y*x243 + P[2][1].y*x247 + P[2][2].y*x248 + P[2][3].y*x244 + x125*x4 + x126*x4 + x193
    x251 = P[0][0].x*x237 + P[0][3].x*x238 + P[1][0].x*x240 + P[1][1].x*x245 + P[1][2].x*x246 + P[1][3].x*x241 + P[2][0].x*x243 + P[2][1].x*x247 + P[2][2].x*x248 + P[2][3].x*x244 + x190 + x4*x84 + x4*x86
    x252 = x231*x249 + x233*x250 + x235*x251
    x253 = 6*x0
    x254 = v*x253
    x255 = 6*x5
    x256 = v*x255
    x257 = x0*x89
    x258 = x27 - 2
    x259 = x253*x258
    x260 = 1 - x27
    x261 = x253*x260
    x262 = x11*x63
    x263 = v*x262
    x264 = v*x139
    x265 = P[2][3].z*x264
    x266 = x5*x89
    x267 = x255*x258
    x268 = x255*x260
    x269 = x262*x7
    x270 = x258*x262
    x271 = x260*x262
    x272 = x139*x7
    x273 = P[2][0].z*x272
    x274 = x139*x258
    x275 = P[2][1].z*x274
    x276 = x139*x260
    x277 = P[2][2].z*x276
    x278 = P[0][0].z*x266 + P[0][1].z*x267 + P[0][2].z*x268 + P[0][3].z*x256 + P[1][0].z*x269 + P[1][1].z*x270 + P[1][2].z*x271 + P[1][3].z*x263 + P[3][0].z*x257 + P[3][1].z*x259 + P[3][2].z*x261 + P[3][3].z*x254 + x265*x4 + x273*x4 + x275*x4 + x277*x4
    x279 = P[3][1].y*x258
    x280 = P[2][3].y*x264
    x281 = P[0][1].y*x258
    x282 = P[2][0].y*x7
    x283 = x139*x282
    x284 = P[2][1].y*x274
    x285 = P[2][2].y*x276
    x286 = P[0][0].y*x266 + P[0][2].y*x268 + P[0][3].y*x256 + P[1][0].y*x269 + P[1][1].y*x270 + P[1][2].y*x271 + P[1][3].y*x263 + P[3][0].y*x257 + P[3][2].y*x261 + P[3][3].y*x254 + x253*x279 + x255*x281 + x280*x4 + x283*x4 + x284*x4 + x285*x4
    x287 = P[2][3].x*x264
    x288 = P[2][0].x*x272
    x289 = P[2][1].x*x274
    x290 = P[2][2].x*x276
    x291 = P[0][0].x*x266 + P[0][1].x*x267 + P[0][2].x*x268 + P[0][3].x*x256 + P[1][0].x*x269 + P[1][1].x*x270 + P[1][2].x*x271 + P[1][3].x*x263 + P[3][0].x*x257 + P[3][1].x*x259 + P[3][2].x*x261 + P[3][3].x*x254 + x287*x4 + x288*x4 + x289*x4 + x290*x4
    x292 = x231*x278 + x233*x286 + x235*x291
    x293 = 4*x292
    x294 = 18*x57
    x295 = 18*x70
    x296 = 54*x72
    x297 = 54*x75
    x298 = x191*x50
    x299 = x194*x223
    x300 = x118*x213
    x301 = -x127*x209
    x302 = x230*(x298 + x299 + x300 + x301)
    x303 = x197*x41
    x304 = x191*x225
    x305 = -x118*x216
    x306 = x136*x209
    x307 = x230*(x303 + x304 + x305 + x306)
    x308 = x194*x55
    x309 = x197*x227
    x310 = x127*x216
    x311 = -x136*x213
    x312 = x230*(x308 + x309 + x310 + x311)
    x313 = (-1/2*x224*(2*x298 + 2*x299 + 2*x300 + 2*x301) - 1/2*x226*(2*x303 + 2*x304 + 2*x305 + 2*x306) - 1/2*x228*(2*x308 + 2*x309 + 2*x310 + 2*x311))/x229**(3/2)
    x314 = x224*x313
    x315 = x226*x313
    x316 = x228*x313
    x317 = x231*(18*P[1][0].z*x70 + 54*P[1][1].z*v*x8 + 54*P[1][2].z*x1*x7 + 18*P[1][3].z*x57 - P[2][0].z*x295 - P[2][1].z*x296 - P[2][2].z*x297 - P[2][3].z*x294 + 6*P[3][0].z*x70 + 18*P[3][1].z*v*x8 + 18*P[3][2].z*x1*x7 + 6*P[3][3].z*x57 - x128 - x131 - x134 - x135) + x233*(18*P[1][0].y*x70 + 54*P[1][1].y*v*x8 + 54*P[1][2].y*x1*x7 + 18*P[1][3].y*x57 - P[2][0].y*x295 - P[2][1].y*x296 - P[2][2].y*x297 - P[2][3].y*x294 + 6*P[3][0].y*x70 + 18*P[3][1].y*v*x8 + 18*P[3][2].y*x1*x7 + 6*P[3][3].y*x57 - x119 - x122 - x125 - x126) + x235*(18*P[1][0].x*x70 + 54*P[1][1].x*v*x8 + 54*P[1][2].x*x1*x7 + 18*P[1][3].x*x57 - P[2][0].x*x295 - P[2][1].x*x296 - P[2][2].x*x297 - P[2][3].x*x294 + 6*P[3][0].x*x70 + 18*P[3][1].x*v*x8 + 18*P[3][2].x*x1*x7 + 6*P[3][3].x*x57 - x62 - x78 - x84 - x86) + x249*x302 + x249*x314 + x250*x307 + x250*x315 + x251*x312 + x251*x316
    x318 = x60*x63
    x319 = v*x318
    x320 = v*x143
    x321 = v*x145
    x322 = x318*x7
    x323 = x258*x318
    x324 = x260*x318
    x325 = x143*x7
    x326 = x143*x258
    x327 = x143*x260
    x328 = x145*x7
    x329 = x145*x258
    x330 = x145*x260
    x331 = x231*(-P[0][0].z*x328 - P[0][1].z*x329 - P[0][2].z*x330 - P[0][3].z*x321 + P[1][0].z*x322 + P[1][0].z*x328 + P[1][1].z*x323 + P[1][1].z*x329 + P[1][2].z*x324 + P[1][2].z*x330 + P[1][3].z*x319 + P[1][3].z*x321 + P[2][0].z*x325 + P[2][1].z*x326 + P[2][2].z*x327 + P[2][3].z*x320 + P[3][0].z*x272 + P[3][1].z*x274 + P[3][2].z*x276 + P[3][3].z*x264 - x265 - x273 - x275 - x277) + x233*(-P[0][0].y*x328 - P[0][2].y*x330 - P[0][3].y*x321 + P[1][0].y*x322 + P[1][0].y*x328 + P[1][1].y*x323 + P[1][1].y*x329 + P[1][2].y*x324 + P[1][2].y*x330 + P[1][3].y*x319 + P[1][3].y*x321 + P[2][1].y*x326 + P[2][2].y*x327 + P[2][3].y*x320 + P[3][0].y*x272 + P[3][2].y*x276 + P[3][3].y*x264 + x139*x279 + x143*x282 - x145*x281 - x280 - x283 - x284 - x285) + x235*(-P[0][0].x*x328 - P[0][1].x*x329 - P[0][2].x*x330 - P[0][3].x*x321 + P[1][0].x*x322 + P[1][0].x*x328 + P[1][1].x*x323 + P[1][1].x*x329 + P[1][2].x*x324 + P[1][2].x*x330 + P[1][3].x*x319 + P[1][3].x*x321 + P[2][0].x*x325 + P[2][1].x*x326 + P[2][2].x*x327 + P[2][3].x*x320 + P[3][0].x*x272 + P[3][1].x*x274 + P[3][2].x*x276 + P[3][3].x*x264 - x287 - x288 - x289 - x290) + x278*x302 + x278*x314 + x286*x307 + x286*x315 + x291*x312 + x291*x316
    x332 = x24*x64
    x333 = x24*x67
    x334 = x172*x24
    x335 = x28*x64
    x336 = x28*x67
    x337 = x172*x28
    x338 = x231*(P[0][0].z*x176 - P[0][1].z*x337 - P[0][2].z*x334 - P[0][3].z*x178 - P[1][0].z*x180 + P[1][1].z*x335 + P[1][2].z*x332 + P[1][3].z*x182 - P[2][0].z*x184 + P[2][1].z*x336 + P[2][2].z*x333 + P[2][3].z*x186 - P[3][0].z*x148 + P[3][1].z*x163 + P[3][2].z*x155 + P[3][3].z*x141)
    x339 = x233*(P[0][0].y*x176 - P[0][2].y*x334 - P[1][0].y*x180 + P[1][1].y*x335 + P[1][2].y*x332 + P[1][3].y*x182 - P[2][0].y*x184 + P[2][1].y*x336 + P[2][2].y*x333 + P[2][3].y*x186 + P[3][1].y*x163 + P[3][2].y*x155 + P[3][3].y*x141 - x166*x175 - x167*x63 - x169*x172)
    x340 = x235*(P[0][0].x*x176 - P[0][1].x*x337 - P[0][2].x*x334 - P[0][3].x*x178 - P[1][0].x*x180 + P[1][1].x*x335 + P[1][2].x*x332 + P[1][3].x*x182 - P[2][0].x*x184 + P[2][1].x*x336 + P[2][2].x*x333 + P[2][3].x*x186 - P[3][0].x*x148 + P[3][1].x*x163 + P[3][2].x*x155 + P[3][3].x*x141)
    x341 = x222*x302
    x342 = x232*x307
    x343 = x234*x312
    x344 = x222*x314
    x345 = x232*x315
    x346 = x234*x316
    x347 = 4*x236
    return -(-4*x236**2 + x252*x293)*(x137*x56 + x138*x170 - x171*(2*x192 + 2*x195 + 2*x198 + 2*x210 + 2*x214 + 2*x217)) - (x138*x56 - x171**2)*(4*x252*x331 + x293*x317 - x347*(2*x338 + 2*x339 + 2*x340 + 2*x341 + 2*x342 + 2*x343 + 2*x344 + 2*x345 + 2*x346)) + (x138*x292 - 2*x171*x236 + x252*x56)*(2*x137*x292 + 2*x138*x331 + 2*x170*x252 - 4*x171*(x338 + x339 + x340 + x341 + x342 + x343 + x344 + x345 + x346) + 2*x317*x56 - x347*(x192 + x195 + x198 + x210 + x214 + x217))

def umbilic_v_derivative(P, u, v):
    x0 = v**3
    x1 = u**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**2
    x6 = 3*x5
    x7 = x0*x6
    x8 = 1 - v
    x9 = x8**3
    x10 = x2*x9
    x11 = x8**2
    x12 = 9*x1
    x13 = x11*x12
    x14 = P[3][1].x*x13
    x15 = v**2
    x16 = x12*x15
    x17 = P[3][2].x*x16
    x18 = x6*x9
    x19 = 9*x5
    x20 = x11*x19
    x21 = P[0][1].x*x20
    x22 = x15*x19
    x23 = P[0][2].x*x22
    x24 = 6*u*x4 - x2
    x25 = x0*x24
    x26 = 3*u
    x27 = x26*(2*u - 2) + x6
    x28 = x0*x27
    x29 = x24*x9
    x30 = 3*x11
    x31 = x24*x30
    x32 = P[2][1].x*x31
    x33 = 3*x15
    x34 = x24*x33
    x35 = P[2][2].x*x34
    x36 = x27*x9
    x37 = x27*x30
    x38 = P[1][1].x*x37
    x39 = x27*x33
    x40 = P[1][2].x*x39
    x41 = -P[0][0].x*x18 - P[0][3].x*x7 + P[1][0].x*x36 + P[1][3].x*x28 + P[2][0].x*x29 + P[2][3].x*x25 + P[3][0].x*x10 + P[3][3].x*x3 + v*x14 - v*x21 + v*x32 + v*x38 + x17*x8 - x23*x8 + x35*x8 + x40*x8
    x42 = P[3][1].y*x13
    x43 = P[3][2].y*x16
    x44 = P[0][1].y*x20
    x45 = P[0][2].y*x22
    x46 = P[2][1].y*x31
    x47 = P[2][2].y*x34
    x48 = P[1][1].y*x37
    x49 = P[1][2].y*x39
    x50 = -P[0][0].y*x18 - P[0][3].y*x7 + P[1][0].y*x36 + P[1][3].y*x28 + P[2][0].y*x29 + P[2][3].y*x25 + P[3][0].y*x10 + P[3][3].y*x3 + v*x42 - v*x44 + v*x46 + v*x48 + x43*x8 - x45*x8 + x47*x8 + x49*x8
    x51 = P[3][1].z*x13
    x52 = P[3][2].z*x16
    x53 = P[0][1].z*x20
    x54 = P[0][2].z*x22
    x55 = P[2][1].z*x31
    x56 = P[2][2].z*x34
    x57 = P[1][1].z*x37
    x58 = P[1][2].z*x39
    x59 = -P[0][0].z*x18 - P[0][3].z*x7 + P[1][0].z*x36 + P[1][3].z*x28 + P[2][0].z*x29 + P[2][3].z*x25 + P[3][0].z*x10 + P[3][3].z*x3 + v*x51 - v*x53 + v*x55 + v*x57 + x52*x8 - x54*x8 + x56*x8 + x58*x8
    x60 = x41**2 + x50**2 + x59**2
    x61 = u**3
    x62 = 12*v
    x63 = x61*x62
    x64 = x4**3
    x65 = x62*x64
    x66 = 2*v - 2
    x67 = 6*x61
    x68 = P[3][0].x*x67
    x69 = 18*v
    x70 = x69 - 12
    x71 = x61*x70
    x72 = P[3][1].x*x71
    x73 = 6 - x69
    x74 = x61*x73
    x75 = P[3][2].x*x74
    x76 = 36*v
    x77 = u*x5*x76
    x78 = x1*x4*x76
    x79 = 6*x64
    x80 = P[0][0].x*x79
    x81 = x64*x70
    x82 = P[0][1].x*x81
    x83 = x64*x73
    x84 = P[0][2].x*x83
    x85 = 18*u
    x86 = x5*x85
    x87 = P[1][0].x*x86
    x88 = 6*u
    x89 = x5*x88
    x90 = x70*x89
    x91 = x73*x89
    x92 = 18*x4
    x93 = x1*x92
    x94 = P[2][0].x*x93
    x95 = 6*x4
    x96 = x1*x95
    x97 = x70*x96
    x98 = x73*x96
    x99 = x33*x61
    x100 = x33*x64
    x101 = x30*x61
    x102 = u*x22
    x103 = x16*x4
    x104 = x30*x64
    x105 = u*x20
    x106 = x13*x4
    x107 = 6*v*x8 - x33
    x108 = x107*x61
    x109 = x107*x64
    x110 = 3*v
    x111 = x110*x66
    x112 = x111 + x30
    x113 = x112*x61
    x114 = x107*x6
    x115 = u*x114
    x116 = x107*x2
    x117 = x116*x4
    x118 = x112*x64
    x119 = x112*x6
    x120 = u*x119
    x121 = x112*x2
    x122 = x121*x4
    x123 = -P[0][0].x*x104 + P[0][1].x*x118 + P[0][2].x*x109 + P[0][3].x*x100 - P[1][0].x*x105 + P[1][1].x*x120 + P[1][2].x*x115 + P[1][3].x*x102 - P[2][0].x*x106 + P[2][1].x*x122 + P[2][2].x*x117 + P[2][3].x*x103 - P[3][0].x*x101 + P[3][1].x*x113 + P[3][2].x*x108 + P[3][3].x*x99
    x124 = P[3][0].y*x67
    x125 = P[3][1].y*x71
    x126 = P[3][2].y*x74
    x127 = P[0][0].y*x79
    x128 = P[0][1].y*x81
    x129 = P[0][2].y*x83
    x130 = P[1][0].y*x86
    x131 = P[2][0].y*x93
    x132 = P[1][2].y*u
    x133 = P[2][2].y*x4
    x134 = -P[0][0].y*x104 + P[0][1].y*x118 + P[0][2].y*x109 + P[0][3].y*x100 - P[1][0].y*x105 + P[1][1].y*x120 + P[1][3].y*x102 - P[2][0].y*x106 + P[2][1].y*x122 + P[2][3].y*x103 - P[3][0].y*x101 + P[3][1].y*x113 + P[3][2].y*x108 + P[3][3].y*x99 + x114*x132 + x116*x133
    x135 = P[3][0].z*x67
    x136 = P[3][1].z*x71
    x137 = P[3][2].z*x74
    x138 = P[0][0].z*x79
    x139 = P[0][1].z*x81
    x140 = P[0][2].z*x83
    x141 = P[1][0].z*x86
    x142 = P[2][0].z*x93
    x143 = -P[0][0].z*x104 + P[0][1].z*x118 + P[0][2].z*x109 + P[0][3].z*x100 - P[1][0].z*x105 + P[1][1].z*x120 + P[1][2].z*x115 + P[1][3].z*x102 - P[2][0].z*x106 + P[2][1].z*x122 + P[2][2].z*x117 + P[2][3].z*x103 - P[3][0].z*x101 + P[3][1].z*x113 + P[3][2].z*x108 + P[3][3].z*x99
    x144 = x123*(P[0][3].x*x65 + P[1][1].x*x90 + P[1][2].x*x91 + P[1][3].x*x77 + P[2][1].x*x97 + P[2][2].x*x98 + P[2][3].x*x78 + P[3][3].x*x63 - x66*x68 - x66*x80 - x66*x87 - x66*x94 + 2*x72 + 2*x75 + 2*x82 + 2*x84) + x134*(P[0][3].y*x65 + P[1][1].y*x90 + P[1][2].y*x91 + P[1][3].y*x77 + P[2][1].y*x97 + P[2][2].y*x98 + P[2][3].y*x78 + P[3][3].y*x63 - x124*x66 + 2*x125 + 2*x126 - x127*x66 + 2*x128 + 2*x129 - x130*x66 - x131*x66) + x143*(P[0][3].z*x65 + P[1][1].z*x90 + P[1][2].z*x91 + P[1][3].z*x77 + P[2][1].z*x97 + P[2][2].z*x98 + P[2][3].z*x78 + P[3][3].z*x63 - x135*x66 + 2*x136 + 2*x137 - x138*x66 + 2*x139 + 2*x140 - x141*x66 - x142*x66)
    x145 = x123**2 + x134**2 + x143**2
    x146 = 18*x1
    x147 = x146*x15
    x148 = x1*x69
    x149 = x148*x66
    x150 = x76*x8
    x151 = x1*x150
    x152 = 18*x5
    x153 = x15*x152
    x154 = x11*x146
    x155 = x5*x69
    x156 = x155*x66
    x157 = x150*x5
    x158 = x11*x152
    x159 = P[0][1].x*x11
    x160 = 6*x24
    x161 = x15*x160
    x162 = 6*v
    x163 = x162*x24
    x164 = x163*x66
    x165 = x62*x8
    x166 = x165*x24
    x167 = 6*x27
    x168 = x15*x167
    x169 = x11*x160
    x170 = x162*x27
    x171 = x170*x66
    x172 = x165*x27
    x173 = x11*x167
    x174 = P[0][3].y*x15
    x175 = P[3][0].y*x11
    x176 = P[2][0].y*x11
    x177 = P[1][0].y*x27
    x178 = x41*(P[0][0].x*x158 - P[0][1].x*x156 + P[0][2].x*x153 - P[0][2].x*x157 - P[0][3].x*x153 - P[1][0].x*x173 + P[1][1].x*x171 + P[1][1].x*x173 - P[1][2].x*x168 + P[1][2].x*x172 + P[1][3].x*x168 - P[2][0].x*x169 + P[2][1].x*x164 + P[2][1].x*x169 - P[2][2].x*x161 + P[2][2].x*x166 + P[2][3].x*x161 - P[3][0].x*x154 + P[3][1].x*x149 + P[3][1].x*x154 - P[3][2].x*x147 + P[3][2].x*x151 + P[3][3].x*x147 - x152*x159) + x50*(P[0][0].y*x158 - P[0][1].y*x156 - P[0][1].y*x158 + P[0][2].y*x153 - P[0][2].y*x157 + P[1][1].y*x171 + P[1][1].y*x173 - P[1][2].y*x168 + P[1][2].y*x172 + P[1][3].y*x168 + P[2][1].y*x164 + P[2][1].y*x169 - P[2][2].y*x161 + P[2][2].y*x166 + P[2][3].y*x161 + P[3][1].y*x149 + P[3][1].y*x154 - P[3][2].y*x147 + P[3][2].y*x151 + P[3][3].y*x147 - 6*x11*x177 - x146*x175 - x152*x174 - x160*x176) + x59*(P[0][0].z*x158 - P[0][1].z*x156 - P[0][1].z*x158 + P[0][2].z*x153 - P[0][2].z*x157 - P[0][3].z*x153 - P[1][0].z*x173 + P[1][1].z*x171 + P[1][1].z*x173 - P[1][2].z*x168 + P[1][2].z*x172 + P[1][3].z*x168 - P[2][0].z*x169 + P[2][1].z*x164 + P[2][1].z*x169 - P[2][2].z*x161 + P[2][2].z*x166 + P[2][3].z*x161 - P[3][0].z*x154 + P[3][1].z*x149 + P[3][1].z*x154 - P[3][2].z*x147 + P[3][2].z*x151 + P[3][3].z*x147)
    x179 = x123*x41 + x134*x50 + x143*x59
    x180 = 3*x66
    x181 = x180*x64
    x182 = x180*x61
    x183 = x19*x66
    x184 = u*x183
    x185 = x12*x66
    x186 = x185*x4
    x187 = x6*x70
    x188 = u*x187
    x189 = x6*x73
    x190 = u*x189
    x191 = x2*x70
    x192 = x191*x4
    x193 = x2*x73
    x194 = x193*x4
    x195 = u*x155
    x196 = x148*x4
    x197 = P[0][3].x*v*x79 + P[1][3].x*x195 + P[2][3].x*x196 + P[3][3].x*v*x67
    x198 = -P[0][0].x*x181 - P[1][0].x*x184 + P[1][1].x*x188 + P[1][2].x*x190 - P[2][0].x*x186 + P[2][1].x*x192 + P[2][2].x*x194 - P[3][0].x*x182 + x197 + x72 + x75 + x82 + x84
    x199 = x198*x41
    x200 = P[0][3].y*v*x79 + P[1][3].y*x195 + P[2][3].y*x196 + P[3][3].y*v*x67
    x201 = -P[0][0].y*x181 - P[1][0].y*x184 + P[1][1].y*x188 - P[2][0].y*x186 + P[2][1].y*x192 - P[3][0].y*x182 + x125 + x126 + x128 + x129 + x132*x189 + x133*x193 + x200
    x202 = x201*x50
    x203 = P[0][3].z*v*x79 + P[1][3].z*x195 + P[2][3].z*x196 + P[3][3].z*v*x67
    x204 = -3*P[0][0].z*x64*x66 - 9*P[1][0].z*u*x5*x66 + P[1][1].z*x188 + P[1][2].z*x190 - 9*P[2][0].z*x1*x4*x66 + P[2][1].z*x192 + P[2][2].z*x194 - 3*P[3][0].z*x61*x66 + x136 + x137 + x139 + x140 + x203
    x205 = x204*x59
    x206 = x155*x8
    x207 = v*x183
    x208 = x111*x27
    x209 = x111*x24
    x210 = 6*x8
    x211 = v*x210
    x212 = x211*x27
    x213 = x211*x24
    x214 = v*x185
    x215 = x148*x8
    x216 = P[0][0].x*x20 - P[0][3].x*x22 - P[1][0].x*x37 + P[1][3].x*x39 - P[2][0].x*x31 + P[2][3].x*x34 - P[3][0].x*x13 + P[3][3].x*x16
    x217 = -P[0][1].x*x207 - P[0][2].x*x206 + P[1][1].x*x208 + P[1][2].x*x212 + P[2][1].x*x209 + P[2][2].x*x213 + P[3][1].x*x214 + P[3][2].x*x215 + x14 - x17 - x21 + x216 + x23 + x32 - x35 + x38 - x40
    x218 = x123*x217
    x219 = P[0][0].y*x20 - P[1][0].y*x37 + P[1][3].y*x39 - P[2][0].y*x31 + P[2][3].y*x34 + P[3][3].y*x16 - x12*x175 - x174*x19
    x220 = -P[0][1].y*x207 - P[0][2].y*x206 + P[1][1].y*x208 + P[1][2].y*x212 + P[2][1].y*x209 + P[2][2].y*x213 + P[3][1].y*x214 + P[3][2].y*x215 + x219 + x42 - x43 - x44 + x45 + x46 - x47 + x48 - x49
    x221 = x134*x220
    x222 = P[0][0].z*x20 - P[0][3].z*x22 - P[1][0].z*x37 + P[1][3].z*x39 - P[2][0].z*x31 + P[2][3].z*x34 - P[3][0].z*x13 + P[3][3].z*x16
    x223 = -P[0][1].z*x207 - P[0][2].z*x206 + P[1][1].z*x208 + P[1][2].z*x212 + P[2][1].z*x209 + P[2][2].z*x213 + P[3][1].z*x214 + P[3][2].z*x215 + x222 + x51 - x52 - x53 + x54 + x55 - x56 + x57 - x58
    x224 = x143*x223
    x225 = x112*x27
    x226 = x107*x27
    x227 = x112*x24
    x228 = x107*x24
    x229 = -P[0][1].z*x119 - P[0][2].z*x114 + P[1][1].z*x225 + P[1][2].z*x226 + P[2][1].z*x227 + P[2][2].z*x228 + P[3][1].z*x121 + P[3][2].z*x116 + x222
    x230 = -x123
    x231 = x134*x41 + x230*x50
    x232 = -x143
    x233 = x123*x59 + x232*x41
    x234 = -x134
    x235 = x143*x50 + x234*x59
    x236 = x231**2 + x233**2 + x235**2
    x237 = 1/sqrt(x236)
    x238 = x231*x237
    x239 = -P[0][1].y*x119 - P[0][2].y*x114 + P[1][1].y*x225 + P[1][2].y*x226 + P[2][1].y*x227 + P[2][2].y*x228 + P[3][1].y*x121 + P[3][2].y*x116 + x219
    x240 = x233*x237
    x241 = -P[0][1].x*x119 - P[0][2].x*x114 + P[1][1].x*x225 + P[1][2].x*x226 + P[2][1].x*x227 + P[2][2].x*x228 + P[3][1].x*x121 + P[3][2].x*x116 + x216
    x242 = x235*x237
    x243 = x229*x238 + x239*x240 + x241*x242
    x244 = x0*x88
    x245 = x0*x95
    x246 = x26 - 2
    x247 = 6*x246
    x248 = x0*x247
    x249 = 1 - x26
    x250 = 6*x249
    x251 = x0*x250
    x252 = x88*x9
    x253 = x11*x69
    x254 = u*x253
    x255 = x15*x85
    x256 = P[3][2].z*x255
    x257 = x9*x95
    x258 = x247*x9
    x259 = x250*x9
    x260 = x253*x4
    x261 = x15*x92
    x262 = P[0][2].z*x261
    x263 = x246*x253
    x264 = 18*x246
    x265 = x15*x264
    x266 = P[1][2].z*x265
    x267 = x249*x253
    x268 = 18*x249
    x269 = x15*x268
    x270 = P[2][2].z*x269
    x271 = P[0][0].z*x257 + P[0][1].z*x260 + P[0][3].z*x245 + P[1][0].z*x258 + P[1][1].z*x263 + P[1][3].z*x248 + P[2][0].z*x259 + P[2][1].z*x267 + P[2][3].z*x251 + P[3][0].z*x252 + P[3][1].z*x254 + P[3][3].z*x244 + x256*x8 + x262*x8 + x266*x8 + x270*x8
    x272 = P[3][2].y*x255
    x273 = P[0][2].y*x261
    x274 = P[1][2].y*x265
    x275 = P[2][2].y*x269
    x276 = P[0][0].y*x257 + P[0][1].y*x260 + P[0][3].y*x245 + P[1][0].y*x258 + P[1][1].y*x263 + P[1][3].y*x248 + P[2][0].y*x259 + P[2][1].y*x267 + P[2][3].y*x251 + P[3][0].y*x252 + P[3][1].y*x254 + P[3][3].y*x244 + x272*x8 + x273*x8 + x274*x8 + x275*x8
    x277 = P[3][2].x*x255
    x278 = x4*x69
    x279 = P[0][2].x*x261
    x280 = P[1][2].x*x265
    x281 = P[2][2].x*x269
    x282 = P[0][0].x*x257 + P[0][3].x*x245 + P[1][0].x*x258 + P[1][1].x*x263 + P[1][3].x*x248 + P[2][0].x*x259 + P[2][1].x*x267 + P[2][3].x*x251 + P[3][0].x*x252 + P[3][1].x*x254 + P[3][3].x*x244 + x159*x278 + x277*x8 + x279*x8 + x280*x8 + x281*x8
    x283 = x238*x271 + x240*x276 + x242*x282
    x284 = x210*x64
    x285 = x110 - 2
    x286 = x285*x79
    x287 = 1 - x110
    x288 = x287*x79
    x289 = x210*x61
    x290 = x285*x67
    x291 = x287*x67
    x292 = x285*x86
    x293 = x287*x86
    x294 = x285*x93
    x295 = x287*x93
    x296 = P[0][0].z*x284 + P[0][1].z*x286 + P[0][2].z*x288 + P[1][1].z*x292 + P[1][2].z*x293 + P[2][1].z*x294 + P[2][2].z*x295 + P[3][0].z*x289 + P[3][1].z*x290 + P[3][2].z*x291 + x141*x8 + x142*x8 + x203
    x297 = P[0][0].y*x284 + P[0][1].y*x286 + P[0][2].y*x288 + P[1][1].y*x292 + P[1][2].y*x293 + P[2][1].y*x294 + P[2][2].y*x295 + P[3][0].y*x289 + P[3][1].y*x290 + P[3][2].y*x291 + x130*x8 + x131*x8 + x200
    x298 = P[0][0].x*x284 + P[0][1].x*x286 + P[0][2].x*x288 + P[1][1].x*x292 + P[1][2].x*x293 + P[2][1].x*x294 + P[2][2].x*x295 + P[3][0].x*x289 + P[3][1].x*x290 + P[3][2].x*x291 + x197 + x8*x87 + x8*x94
    x299 = x238*x296 + x240*x297 + x242*x298
    x300 = 4*x299
    x301 = 18*x61
    x302 = 18*x64
    x303 = 54*x5
    x304 = u*x303
    x305 = 54*x1
    x306 = x305*x4
    x307 = x201*x41
    x308 = -x198*x50
    x309 = x134*x217
    x310 = x220*x230
    x311 = x237*(x307 + x308 + x309 + x310)
    x312 = x198*x59
    x313 = -x204*x41
    x314 = x123*x223
    x315 = x217*x232
    x316 = x237*(x312 + x313 + x314 + x315)
    x317 = x204*x50
    x318 = -x201*x59
    x319 = x143*x220
    x320 = x223*x234
    x321 = x237*(x317 + x318 + x319 + x320)
    x322 = (-1/2*x231*(2*x307 + 2*x308 + 2*x309 + 2*x310) - 1/2*x233*(2*x312 + 2*x313 + 2*x314 + 2*x315) - 1/2*x235*(2*x317 + 2*x318 + 2*x319 + 2*x320))/x236**(3/2)
    x323 = x231*x322
    x324 = x233*x322
    x325 = x235*x322
    x326 = x238*(18*P[0][1].z*x64 - P[0][2].z*x302 + 6*P[0][3].z*x64 + 54*P[1][1].z*u*x5 - P[1][2].z*x304 + 18*P[1][3].z*u*x5 + 54*P[2][1].z*x1*x4 - P[2][2].z*x306 + 18*P[2][3].z*x1*x4 + 18*P[3][1].z*x61 - P[3][2].z*x301 + 6*P[3][3].z*x61 - x135 - x138 - x141 - x142) + x240*(18*P[0][1].y*x64 - P[0][2].y*x302 + 6*P[0][3].y*x64 + 54*P[1][1].y*u*x5 + 18*P[1][3].y*u*x5 + 54*P[2][1].y*x1*x4 + 18*P[2][3].y*x1*x4 + 18*P[3][1].y*x61 - P[3][2].y*x301 + 6*P[3][3].y*x61 - x124 - x127 - x130 - x131 - x132*x303 - x133*x305) + x242*(18*P[0][1].x*x64 - P[0][2].x*x302 + 6*P[0][3].x*x64 + 54*P[1][1].x*u*x5 - P[1][2].x*x304 + 18*P[1][3].x*u*x5 + 54*P[2][1].x*x1*x4 - P[2][2].x*x306 + 18*P[2][3].x*x1*x4 + 18*P[3][1].x*x61 - P[3][2].x*x301 + 6*P[3][3].x*x61 - x68 - x80 - x87 - x94) + x296*x311 + x296*x323 + x297*x316 + x297*x324 + x298*x321 + x298*x325
    x327 = x66*x69
    x328 = u*x327
    x329 = u*x150
    x330 = x11*x85
    x331 = x278*x66
    x332 = x150*x4
    x333 = x246*x327
    x334 = x150*x246
    x335 = x249*x327
    x336 = x150*x249
    x337 = x11*x92
    x338 = x11*x264
    x339 = x11*x268
    x340 = x238*(-P[0][0].z*x337 + P[0][1].z*x331 + P[0][1].z*x337 + P[0][2].z*x332 + P[0][3].z*x261 - P[1][0].z*x338 + P[1][1].z*x333 + P[1][1].z*x338 + P[1][2].z*x334 + P[1][3].z*x265 - P[2][0].z*x339 + P[2][1].z*x335 + P[2][1].z*x339 + P[2][2].z*x336 + P[2][3].z*x269 - P[3][0].z*x330 + P[3][1].z*x328 + P[3][1].z*x330 + P[3][2].z*x329 + P[3][3].z*x255 - x256 - x262 - x266 - x270) + x240*(-P[0][0].y*x337 + P[0][1].y*x331 + P[0][1].y*x337 + P[0][2].y*x332 - P[1][0].y*x338 + P[1][1].y*x333 + P[1][1].y*x338 + P[1][2].y*x334 + P[1][3].y*x265 + P[2][1].y*x335 + P[2][1].y*x339 + P[2][2].y*x336 + P[2][3].y*x269 + P[3][1].y*x328 + P[3][1].y*x330 + P[3][2].y*x329 + P[3][3].y*x255 + x174*x92 - x175*x85 - x176*x268 - x272 - x273 - x274 - x275) + x242*(-P[0][0].x*x337 + P[0][1].x*x331 + P[0][1].x*x337 + P[0][2].x*x332 + P[0][3].x*x261 - P[1][0].x*x338 + P[1][1].x*x333 + P[1][1].x*x338 + P[1][2].x*x334 + P[1][3].x*x265 - P[2][0].x*x339 + P[2][1].x*x335 + P[2][1].x*x339 + P[2][2].x*x336 + P[2][3].x*x269 - P[3][0].x*x330 + P[3][1].x*x328 + P[3][1].x*x330 + P[3][2].x*x329 + P[3][3].x*x255 - x277 - x279 - x280 - x281) + x271*x311 + x271*x323 + x276*x316 + x276*x324 + x282*x321 + x282*x325
    x341 = x24*x70
    x342 = x24*x73
    x343 = x180*x24
    x344 = x27*x70
    x345 = x27*x73
    x346 = x180*x27
    x347 = x238*(P[0][0].z*x183 - P[0][1].z*x187 - P[0][2].z*x189 - P[0][3].z*x155 - P[1][0].z*x346 + P[1][1].z*x344 + P[1][2].z*x345 + P[1][3].z*x170 - P[2][0].z*x343 + P[2][1].z*x341 + P[2][2].z*x342 + P[2][3].z*x163 - P[3][0].z*x185 + P[3][1].z*x191 + P[3][2].z*x193 + P[3][3].z*x148)
    x348 = x240*(P[0][0].y*x183 - P[0][1].y*x187 - P[0][2].y*x189 - P[0][3].y*x155 + P[1][1].y*x344 + P[1][2].y*x345 + P[1][3].y*x170 - P[2][0].y*x343 + P[2][1].y*x341 + P[2][2].y*x342 + P[2][3].y*x163 - P[3][0].y*x185 + P[3][1].y*x191 + P[3][2].y*x193 + P[3][3].y*x148 - x177*x180)
    x349 = x242*(P[0][0].x*x183 - P[0][1].x*x187 - P[0][2].x*x189 - P[0][3].x*x155 - P[1][0].x*x346 + P[1][1].x*x344 + P[1][2].x*x345 + P[1][3].x*x170 - P[2][0].x*x343 + P[2][1].x*x341 + P[2][2].x*x342 + P[2][3].x*x163 - P[3][0].x*x185 + P[3][1].x*x191 + P[3][2].x*x193 + P[3][3].x*x148)
    x350 = x229*x311
    x351 = x239*x316
    x352 = x241*x321
    x353 = x229*x323
    x354 = x239*x324
    x355 = x241*x325
    x356 = 4*x243
    return -(-4*x243**2 + x283*x300)*(x144*x60 + x145*x178 - x179*(2*x199 + 2*x202 + 2*x205 + 2*x218 + 2*x221 + 2*x224)) - (x145*x60 - x179**2)*(4*x283*x326 + x300*x340 - x356*(2*x347 + 2*x348 + 2*x349 + 2*x350 + 2*x351 + 2*x352 + 2*x353 + 2*x354 + 2*x355)) + (x145*x283 - 2*x179*x243 + x299*x60)*(2*x144*x283 + 2*x145*x340 + 2*x178*x299 - 4*x179*(x347 + x348 + x349 + x350 + x351 + x352 + x353 + x354 + x355) + 2*x326*x60 - x356*(x199 + x202 + x205 + x218 + x221 + x224))

def min_principal_curvature(P, u, v):
    x0 = v**3
    x1 = u**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**2
    x6 = 3*x5
    x7 = x0*x6
    x8 = 1 - v
    x9 = x8**3
    x10 = x2*x9
    x11 = x8**2
    x12 = 9*x1
    x13 = x11*x12
    x14 = v*x13
    x15 = v**2
    x16 = x12*x15
    x17 = x16*x8
    x18 = x6*x9
    x19 = 9*x5
    x20 = x11*x19
    x21 = v*x20
    x22 = x15*x19
    x23 = x22*x8
    x24 = 6*u*x4 - x2
    x25 = x0*x24
    x26 = 3*u
    x27 = x26*(2*u - 2) + x6
    x28 = x0*x27
    x29 = x24*x9
    x30 = 3*x11
    x31 = x24*x30
    x32 = v*x31
    x33 = 3*x15
    x34 = x24*x33
    x35 = x34*x8
    x36 = x27*x9
    x37 = x27*x30
    x38 = v*x37
    x39 = x27*x33
    x40 = x39*x8
    x41 = -P[0][0].x*x18 - P[0][1].x*x21 - P[0][2].x*x23 - P[0][3].x*x7 + P[1][0].x*x36 + P[1][1].x*x38 + P[1][2].x*x40 + P[1][3].x*x28 + P[2][0].x*x29 + P[2][1].x*x32 + P[2][2].x*x35 + P[2][3].x*x25 + P[3][0].x*x10 + P[3][1].x*x14 + P[3][2].x*x17 + P[3][3].x*x3
    x42 = u**3
    x43 = x33*x42
    x44 = x4**3
    x45 = x33*x44
    x46 = x30*x42
    x47 = u*x22
    x48 = x16*x4
    x49 = x30*x44
    x50 = u*x20
    x51 = x13*x4
    x52 = 6*v*x8 - x33
    x53 = x42*x52
    x54 = x44*x52
    x55 = 3*v
    x56 = x30 + x55*(2*v - 2)
    x57 = x42*x56
    x58 = x52*x6
    x59 = u*x58
    x60 = x2*x52
    x61 = x4*x60
    x62 = x44*x56
    x63 = x56*x6
    x64 = u*x63
    x65 = x2*x56
    x66 = x4*x65
    x67 = -P[0][0].x*x49 + P[0][1].x*x62 + P[0][2].x*x54 + P[0][3].x*x45 - P[1][0].x*x50 + P[1][1].x*x64 + P[1][2].x*x59 + P[1][3].x*x47 - P[2][0].x*x51 + P[2][1].x*x66 + P[2][2].x*x61 + P[2][3].x*x48 - P[3][0].x*x46 + P[3][1].x*x57 + P[3][2].x*x53 + P[3][3].x*x43
    x68 = -P[0][0].y*x18 - P[0][1].y*x21 - P[0][2].y*x23 - P[0][3].y*x7 + P[1][0].y*x36 + P[1][1].y*x38 + P[1][2].y*x40 + P[1][3].y*x28 + P[2][0].y*x29 + P[2][1].y*x32 + P[2][2].y*x35 + P[2][3].y*x25 + P[3][0].y*x10 + P[3][1].y*x14 + P[3][2].y*x17 + P[3][3].y*x3
    x69 = -P[0][0].y*x49 + P[0][1].y*x62 + P[0][2].y*x54 + P[0][3].y*x45 - P[1][0].y*x50 + P[1][1].y*x64 + P[1][2].y*x59 + P[1][3].y*x47 - P[2][0].y*x51 + P[2][1].y*x66 + P[2][2].y*x61 + P[2][3].y*x48 - P[3][0].y*x46 + P[3][1].y*x57 + P[3][2].y*x53 + P[3][3].y*x43
    x70 = -P[0][0].z*x18 - P[0][1].z*x21 - P[0][2].z*x23 - P[0][3].z*x7 + P[1][0].z*x36 + P[1][1].z*x38 + P[1][2].z*x40 + P[1][3].z*x28 + P[2][0].z*x29 + P[2][1].z*x32 + P[2][2].z*x35 + P[2][3].z*x25 + P[3][0].z*x10 + P[3][1].z*x14 + P[3][2].z*x17 + P[3][3].z*x3
    x71 = -P[0][0].z*x49 + P[0][1].z*x62 + P[0][2].z*x54 + P[0][3].z*x45 - P[1][0].z*x50 + P[1][1].z*x64 + P[1][2].z*x59 + P[1][3].z*x47 - P[2][0].z*x51 + P[2][1].z*x66 + P[2][2].z*x61 + P[2][3].z*x48 - P[3][0].z*x46 + P[3][1].z*x57 + P[3][2].z*x53 + P[3][3].z*x43
    x72 = x41*x67 + x68*x69 + x70*x71
    x73 = x72**2
    x74 = x41**2 + x68**2 + x70**2
    x75 = x67**2 + x69**2 + x71**2
    x76 = -2*x73 + 2*x74*x75
    x77 = 6*u
    x78 = x0*x77
    x79 = 6*x4
    x80 = x0*x79
    x81 = x26 - 2
    x82 = 6*x81
    x83 = x0*x82
    x84 = 1 - x26
    x85 = 6*x84
    x86 = x0*x85
    x87 = x77*x9
    x88 = v*x11
    x89 = 18*u
    x90 = x88*x89
    x91 = x15*x8
    x92 = x89*x91
    x93 = x79*x9
    x94 = x82*x9
    x95 = x85*x9
    x96 = 18*x4
    x97 = x88*x96
    x98 = x91*x96
    x99 = 18*x81
    x100 = x88*x99
    x101 = x91*x99
    x102 = 18*x84
    x103 = x102*x88
    x104 = x102*x91
    x105 = x41*x69 - x67*x68
    x106 = -x41*x71 + x67*x70
    x107 = x68*x71 - x69*x70
    x108 = 1/sqrt(x105**2 + x106**2 + x107**2)
    x109 = x105*x108
    x110 = x106*x108
    x111 = x107*x108
    x112 = x109*(P[0][0].z*x93 + P[0][1].z*x97 + P[0][2].z*x98 + P[0][3].z*x80 + P[1][0].z*x94 + P[1][1].z*x100 + P[1][2].z*x101 + P[1][3].z*x83 + P[2][0].z*x95 + P[2][1].z*x103 + P[2][2].z*x104 + P[2][3].z*x86 + P[3][0].z*x87 + P[3][1].z*x90 + P[3][2].z*x92 + P[3][3].z*x78) + x110*(P[0][0].y*x93 + P[0][1].y*x97 + P[0][2].y*x98 + P[0][3].y*x80 + P[1][0].y*x94 + P[1][1].y*x100 + P[1][2].y*x101 + P[1][3].y*x83 + P[2][0].y*x95 + P[2][1].y*x103 + P[2][2].y*x104 + P[2][3].y*x86 + P[3][0].y*x87 + P[3][1].y*x90 + P[3][2].y*x92 + P[3][3].y*x78) + x111*(P[0][0].x*x93 + P[0][1].x*x97 + P[0][2].x*x98 + P[0][3].x*x80 + P[1][0].x*x94 + P[1][1].x*x100 + P[1][2].x*x101 + P[1][3].x*x83 + P[2][0].x*x95 + P[2][1].x*x103 + P[2][2].x*x104 + P[2][3].x*x86 + P[3][0].x*x87 + P[3][1].x*x90 + P[3][2].x*x92 + P[3][3].x*x78)
    x113 = 6*x42
    x114 = v*x113
    x115 = 6*x44
    x116 = v*x115
    x117 = 6*x8
    x118 = x117*x42
    x119 = x55 - 2
    x120 = x113*x119
    x121 = 1 - x55
    x122 = x113*x121
    x123 = x5*x89
    x124 = v*x123
    x125 = x1*x96
    x126 = v*x125
    x127 = x117*x44
    x128 = x115*x119
    x129 = x115*x121
    x130 = x123*x8
    x131 = x119*x123
    x132 = x121*x123
    x133 = x125*x8
    x134 = x119*x125
    x135 = x121*x125
    x136 = x109*(P[0][0].z*x127 + P[0][1].z*x128 + P[0][2].z*x129 + P[0][3].z*x116 + P[1][0].z*x130 + P[1][1].z*x131 + P[1][2].z*x132 + P[1][3].z*x124 + P[2][0].z*x133 + P[2][1].z*x134 + P[2][2].z*x135 + P[2][3].z*x126 + P[3][0].z*x118 + P[3][1].z*x120 + P[3][2].z*x122 + P[3][3].z*x114) + x110*(P[0][0].y*x127 + P[0][1].y*x128 + P[0][2].y*x129 + P[0][3].y*x116 + P[1][0].y*x130 + P[1][1].y*x131 + P[1][2].y*x132 + P[1][3].y*x124 + P[2][0].y*x133 + P[2][1].y*x134 + P[2][2].y*x135 + P[2][3].y*x126 + P[3][0].y*x118 + P[3][1].y*x120 + P[3][2].y*x122 + P[3][3].y*x114) + x111*(P[0][0].x*x127 + P[0][1].x*x128 + P[0][2].x*x129 + P[0][3].x*x116 + P[1][0].x*x130 + P[1][1].x*x131 + P[1][2].x*x132 + P[1][3].x*x124 + P[2][0].x*x133 + P[2][1].x*x134 + P[2][2].x*x135 + P[2][3].x*x126 + P[3][0].x*x118 + P[3][1].x*x120 + P[3][2].x*x122 + P[3][3].x*x114)
    x137 = x24*x52
    x138 = x27*x52
    x139 = x24*x56
    x140 = x27*x56
    x141 = x109*(P[0][0].z*x20 - P[0][1].z*x63 - P[0][2].z*x58 - P[0][3].z*x22 - P[1][0].z*x37 + P[1][1].z*x140 + P[1][2].z*x138 + P[1][3].z*x39 - P[2][0].z*x31 + P[2][1].z*x139 + P[2][2].z*x137 + P[2][3].z*x34 - P[3][0].z*x13 + P[3][1].z*x65 + P[3][2].z*x60 + P[3][3].z*x16) + x110*(P[0][0].y*x20 - P[0][1].y*x63 - P[0][2].y*x58 - P[0][3].y*x22 - P[1][0].y*x37 + P[1][1].y*x140 + P[1][2].y*x138 + P[1][3].y*x39 - P[2][0].y*x31 + P[2][1].y*x139 + P[2][2].y*x137 + P[2][3].y*x34 - P[3][0].y*x13 + P[3][1].y*x65 + P[3][2].y*x60 + P[3][3].y*x16) + x111*(P[0][0].x*x20 - P[0][1].x*x63 - P[0][2].x*x58 - P[0][3].x*x22 - P[1][0].x*x37 + P[1][1].x*x140 + P[1][2].x*x138 + P[1][3].x*x39 - P[2][0].x*x31 + P[2][1].x*x139 + P[2][2].x*x137 + P[2][3].x*x34 - P[3][0].x*x13 + P[3][1].x*x65 + P[3][2].x*x60 + P[3][3].x*x16)
    x142 = -x112*x75 - x136*x74 + 2*x141*x72
    return x142/x76 - sqrt(x142**2/x76**2 - (x112*x136 - x141**2)/(-x73 + x74*x75))

def max_principal_curvature(P, u, v):
    x0 = v**3
    x1 = u**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**2
    x6 = 3*x5
    x7 = x0*x6
    x8 = 1 - v
    x9 = x8**3
    x10 = x2*x9
    x11 = x8**2
    x12 = 9*x1
    x13 = x11*x12
    x14 = v*x13
    x15 = v**2
    x16 = x12*x15
    x17 = x16*x8
    x18 = x6*x9
    x19 = 9*x5
    x20 = x11*x19
    x21 = v*x20
    x22 = x15*x19
    x23 = x22*x8
    x24 = 6*u*x4 - x2
    x25 = x0*x24
    x26 = 3*u
    x27 = x26*(2*u - 2) + x6
    x28 = x0*x27
    x29 = x24*x9
    x30 = 3*x11
    x31 = x24*x30
    x32 = v*x31
    x33 = 3*x15
    x34 = x24*x33
    x35 = x34*x8
    x36 = x27*x9
    x37 = x27*x30
    x38 = v*x37
    x39 = x27*x33
    x40 = x39*x8
    x41 = -P[0][0].x*x18 - P[0][1].x*x21 - P[0][2].x*x23 - P[0][3].x*x7 + P[1][0].x*x36 + P[1][1].x*x38 + P[1][2].x*x40 + P[1][3].x*x28 + P[2][0].x*x29 + P[2][1].x*x32 + P[2][2].x*x35 + P[2][3].x*x25 + P[3][0].x*x10 + P[3][1].x*x14 + P[3][2].x*x17 + P[3][3].x*x3
    x42 = u**3
    x43 = x33*x42
    x44 = x4**3
    x45 = x33*x44
    x46 = x30*x42
    x47 = u*x22
    x48 = x16*x4
    x49 = x30*x44
    x50 = u*x20
    x51 = x13*x4
    x52 = 6*v*x8 - x33
    x53 = x42*x52
    x54 = x44*x52
    x55 = 3*v
    x56 = x30 + x55*(2*v - 2)
    x57 = x42*x56
    x58 = x52*x6
    x59 = u*x58
    x60 = x2*x52
    x61 = x4*x60
    x62 = x44*x56
    x63 = x56*x6
    x64 = u*x63
    x65 = x2*x56
    x66 = x4*x65
    x67 = -P[0][0].x*x49 + P[0][1].x*x62 + P[0][2].x*x54 + P[0][3].x*x45 - P[1][0].x*x50 + P[1][1].x*x64 + P[1][2].x*x59 + P[1][3].x*x47 - P[2][0].x*x51 + P[2][1].x*x66 + P[2][2].x*x61 + P[2][3].x*x48 - P[3][0].x*x46 + P[3][1].x*x57 + P[3][2].x*x53 + P[3][3].x*x43
    x68 = -P[0][0].y*x18 - P[0][1].y*x21 - P[0][2].y*x23 - P[0][3].y*x7 + P[1][0].y*x36 + P[1][1].y*x38 + P[1][2].y*x40 + P[1][3].y*x28 + P[2][0].y*x29 + P[2][1].y*x32 + P[2][2].y*x35 + P[2][3].y*x25 + P[3][0].y*x10 + P[3][1].y*x14 + P[3][2].y*x17 + P[3][3].y*x3
    x69 = -P[0][0].y*x49 + P[0][1].y*x62 + P[0][2].y*x54 + P[0][3].y*x45 - P[1][0].y*x50 + P[1][1].y*x64 + P[1][2].y*x59 + P[1][3].y*x47 - P[2][0].y*x51 + P[2][1].y*x66 + P[2][2].y*x61 + P[2][3].y*x48 - P[3][0].y*x46 + P[3][1].y*x57 + P[3][2].y*x53 + P[3][3].y*x43
    x70 = -P[0][0].z*x18 - P[0][1].z*x21 - P[0][2].z*x23 - P[0][3].z*x7 + P[1][0].z*x36 + P[1][1].z*x38 + P[1][2].z*x40 + P[1][3].z*x28 + P[2][0].z*x29 + P[2][1].z*x32 + P[2][2].z*x35 + P[2][3].z*x25 + P[3][0].z*x10 + P[3][1].z*x14 + P[3][2].z*x17 + P[3][3].z*x3
    x71 = -P[0][0].z*x49 + P[0][1].z*x62 + P[0][2].z*x54 + P[0][3].z*x45 - P[1][0].z*x50 + P[1][1].z*x64 + P[1][2].z*x59 + P[1][3].z*x47 - P[2][0].z*x51 + P[2][1].z*x66 + P[2][2].z*x61 + P[2][3].z*x48 - P[3][0].z*x46 + P[3][1].z*x57 + P[3][2].z*x53 + P[3][3].z*x43
    x72 = x41*x67 + x68*x69 + x70*x71
    x73 = x72**2
    x74 = x41**2 + x68**2 + x70**2
    x75 = x67**2 + x69**2 + x71**2
    x76 = -2*x73 + 2*x74*x75
    x77 = 6*u
    x78 = x0*x77
    x79 = 6*x4
    x80 = x0*x79
    x81 = x26 - 2
    x82 = 6*x81
    x83 = x0*x82
    x84 = 1 - x26
    x85 = 6*x84
    x86 = x0*x85
    x87 = x77*x9
    x88 = v*x11
    x89 = 18*u
    x90 = x88*x89
    x91 = x15*x8
    x92 = x89*x91
    x93 = x79*x9
    x94 = x82*x9
    x95 = x85*x9
    x96 = 18*x4
    x97 = x88*x96
    x98 = x91*x96
    x99 = 18*x81
    x100 = x88*x99
    x101 = x91*x99
    x102 = 18*x84
    x103 = x102*x88
    x104 = x102*x91
    x105 = x41*x69 - x67*x68
    x106 = -x41*x71 + x67*x70
    x107 = x68*x71 - x69*x70
    x108 = 1/sqrt(x105**2 + x106**2 + x107**2)
    x109 = x105*x108
    x110 = x106*x108
    x111 = x107*x108
    x112 = x109*(P[0][0].z*x93 + P[0][1].z*x97 + P[0][2].z*x98 + P[0][3].z*x80 + P[1][0].z*x94 + P[1][1].z*x100 + P[1][2].z*x101 + P[1][3].z*x83 + P[2][0].z*x95 + P[2][1].z*x103 + P[2][2].z*x104 + P[2][3].z*x86 + P[3][0].z*x87 + P[3][1].z*x90 + P[3][2].z*x92 + P[3][3].z*x78) + x110*(P[0][0].y*x93 + P[0][1].y*x97 + P[0][2].y*x98 + P[0][3].y*x80 + P[1][0].y*x94 + P[1][1].y*x100 + P[1][2].y*x101 + P[1][3].y*x83 + P[2][0].y*x95 + P[2][1].y*x103 + P[2][2].y*x104 + P[2][3].y*x86 + P[3][0].y*x87 + P[3][1].y*x90 + P[3][2].y*x92 + P[3][3].y*x78) + x111*(P[0][0].x*x93 + P[0][1].x*x97 + P[0][2].x*x98 + P[0][3].x*x80 + P[1][0].x*x94 + P[1][1].x*x100 + P[1][2].x*x101 + P[1][3].x*x83 + P[2][0].x*x95 + P[2][1].x*x103 + P[2][2].x*x104 + P[2][3].x*x86 + P[3][0].x*x87 + P[3][1].x*x90 + P[3][2].x*x92 + P[3][3].x*x78)
    x113 = 6*x42
    x114 = v*x113
    x115 = 6*x44
    x116 = v*x115
    x117 = 6*x8
    x118 = x117*x42
    x119 = x55 - 2
    x120 = x113*x119
    x121 = 1 - x55
    x122 = x113*x121
    x123 = x5*x89
    x124 = v*x123
    x125 = x1*x96
    x126 = v*x125
    x127 = x117*x44
    x128 = x115*x119
    x129 = x115*x121
    x130 = x123*x8
    x131 = x119*x123
    x132 = x121*x123
    x133 = x125*x8
    x134 = x119*x125
    x135 = x121*x125
    x136 = x109*(P[0][0].z*x127 + P[0][1].z*x128 + P[0][2].z*x129 + P[0][3].z*x116 + P[1][0].z*x130 + P[1][1].z*x131 + P[1][2].z*x132 + P[1][3].z*x124 + P[2][0].z*x133 + P[2][1].z*x134 + P[2][2].z*x135 + P[2][3].z*x126 + P[3][0].z*x118 + P[3][1].z*x120 + P[3][2].z*x122 + P[3][3].z*x114) + x110*(P[0][0].y*x127 + P[0][1].y*x128 + P[0][2].y*x129 + P[0][3].y*x116 + P[1][0].y*x130 + P[1][1].y*x131 + P[1][2].y*x132 + P[1][3].y*x124 + P[2][0].y*x133 + P[2][1].y*x134 + P[2][2].y*x135 + P[2][3].y*x126 + P[3][0].y*x118 + P[3][1].y*x120 + P[3][2].y*x122 + P[3][3].y*x114) + x111*(P[0][0].x*x127 + P[0][1].x*x128 + P[0][2].x*x129 + P[0][3].x*x116 + P[1][0].x*x130 + P[1][1].x*x131 + P[1][2].x*x132 + P[1][3].x*x124 + P[2][0].x*x133 + P[2][1].x*x134 + P[2][2].x*x135 + P[2][3].x*x126 + P[3][0].x*x118 + P[3][1].x*x120 + P[3][2].x*x122 + P[3][3].x*x114)
    x137 = x24*x52
    x138 = x27*x52
    x139 = x24*x56
    x140 = x27*x56
    x141 = x109*(P[0][0].z*x20 - P[0][1].z*x63 - P[0][2].z*x58 - P[0][3].z*x22 - P[1][0].z*x37 + P[1][1].z*x140 + P[1][2].z*x138 + P[1][3].z*x39 - P[2][0].z*x31 + P[2][1].z*x139 + P[2][2].z*x137 + P[2][3].z*x34 - P[3][0].z*x13 + P[3][1].z*x65 + P[3][2].z*x60 + P[3][3].z*x16) + x110*(P[0][0].y*x20 - P[0][1].y*x63 - P[0][2].y*x58 - P[0][3].y*x22 - P[1][0].y*x37 + P[1][1].y*x140 + P[1][2].y*x138 + P[1][3].y*x39 - P[2][0].y*x31 + P[2][1].y*x139 + P[2][2].y*x137 + P[2][3].y*x34 - P[3][0].y*x13 + P[3][1].y*x65 + P[3][2].y*x60 + P[3][3].y*x16) + x111*(P[0][0].x*x20 - P[0][1].x*x63 - P[0][2].x*x58 - P[0][3].x*x22 - P[1][0].x*x37 + P[1][1].x*x140 + P[1][2].x*x138 + P[1][3].x*x39 - P[2][0].x*x31 + P[2][1].x*x139 + P[2][2].x*x137 + P[2][3].x*x34 - P[3][0].x*x13 + P[3][1].x*x65 + P[3][2].x*x60 + P[3][3].x*x16)
    x142 = -x112*x75 - x136*x74 + 2*x141*x72
    return x142/x76 + sqrt(x142**2/x76**2 - (x112*x136 - x141**2)/(-x73 + x74*x75))

def principle_direction_u_1(P, kp, u, v):
    x0 = v**3
    x1 = u**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**2
    x6 = 3*x5
    x7 = x0*x6
    x8 = 1 - v
    x9 = x8**3
    x10 = x2*x9
    x11 = x8**2
    x12 = 9*x1
    x13 = x11*x12
    x14 = v*x13
    x15 = v**2
    x16 = x12*x15
    x17 = x16*x8
    x18 = x6*x9
    x19 = 9*x5
    x20 = x11*x19
    x21 = v*x20
    x22 = x15*x19
    x23 = x22*x8
    x24 = 6*u*x4 - x2
    x25 = x0*x24
    x26 = 3*u*(2*u - 2) + x6
    x27 = x0*x26
    x28 = x24*x9
    x29 = 3*x11
    x30 = x24*x29
    x31 = v*x30
    x32 = 3*x15
    x33 = x24*x32
    x34 = x33*x8
    x35 = x26*x9
    x36 = x26*x29
    x37 = v*x36
    x38 = x26*x32
    x39 = x38*x8
    x40 = -P[0][0].x*x18 - P[0][1].x*x21 - P[0][2].x*x23 - P[0][3].x*x7 + P[1][0].x*x35 + P[1][1].x*x37 + P[1][2].x*x39 + P[1][3].x*x27 + P[2][0].x*x28 + P[2][1].x*x31 + P[2][2].x*x34 + P[2][3].x*x25 + P[3][0].x*x10 + P[3][1].x*x14 + P[3][2].x*x17 + P[3][3].x*x3
    x41 = u**3
    x42 = x32*x41
    x43 = x4**3
    x44 = x32*x43
    x45 = x29*x41
    x46 = u*x22
    x47 = x16*x4
    x48 = x29*x43
    x49 = u*x20
    x50 = x13*x4
    x51 = 6*v*x8 - x32
    x52 = x41*x51
    x53 = x43*x51
    x54 = 3*v*(2*v - 2) + x29
    x55 = x41*x54
    x56 = x51*x6
    x57 = u*x56
    x58 = x2*x51
    x59 = x4*x58
    x60 = x43*x54
    x61 = x54*x6
    x62 = u*x61
    x63 = x2*x54
    x64 = x4*x63
    x65 = -P[0][0].x*x48 + P[0][1].x*x60 + P[0][2].x*x53 + P[0][3].x*x44 - P[1][0].x*x49 + P[1][1].x*x62 + P[1][2].x*x57 + P[1][3].x*x46 - P[2][0].x*x50 + P[2][1].x*x64 + P[2][2].x*x59 + P[2][3].x*x47 - P[3][0].x*x45 + P[3][1].x*x55 + P[3][2].x*x52 + P[3][3].x*x42
    x66 = -P[0][0].y*x18 - P[0][1].y*x21 - P[0][2].y*x23 - P[0][3].y*x7 + P[1][0].y*x35 + P[1][1].y*x37 + P[1][2].y*x39 + P[1][3].y*x27 + P[2][0].y*x28 + P[2][1].y*x31 + P[2][2].y*x34 + P[2][3].y*x25 + P[3][0].y*x10 + P[3][1].y*x14 + P[3][2].y*x17 + P[3][3].y*x3
    x67 = -P[0][0].y*x48 + P[0][1].y*x60 + P[0][2].y*x53 + P[0][3].y*x44 - P[1][0].y*x49 + P[1][1].y*x62 + P[1][2].y*x57 + P[1][3].y*x46 - P[2][0].y*x50 + P[2][1].y*x64 + P[2][2].y*x59 + P[2][3].y*x47 - P[3][0].y*x45 + P[3][1].y*x55 + P[3][2].y*x52 + P[3][3].y*x42
    x68 = -P[0][0].z*x18 - P[0][1].z*x21 - P[0][2].z*x23 - P[0][3].z*x7 + P[1][0].z*x35 + P[1][1].z*x37 + P[1][2].z*x39 + P[1][3].z*x27 + P[2][0].z*x28 + P[2][1].z*x31 + P[2][2].z*x34 + P[2][3].z*x25 + P[3][0].z*x10 + P[3][1].z*x14 + P[3][2].z*x17 + P[3][3].z*x3
    x69 = -P[0][0].z*x48 + P[0][1].z*x60 + P[0][2].z*x53 + P[0][3].z*x44 - P[1][0].z*x49 + P[1][1].z*x62 + P[1][2].z*x57 + P[1][3].z*x46 - P[2][0].z*x50 + P[2][1].z*x64 + P[2][2].z*x59 + P[2][3].z*x47 - P[3][0].z*x45 + P[3][1].z*x55 + P[3][2].z*x52 + P[3][3].z*x42
    x70 = x24*x51
    x71 = x26*x51
    x72 = x24*x54
    x73 = x26*x54
    x74 = x40*x67 - x65*x66
    x75 = -x40*x69 + x65*x68
    x76 = x66*x69 - x67*x68
    x77 = 1/sqrt(x74**2 + x75**2 + x76**2)
    return -kp*(x40*x65 + x66*x67 + x68*x69) - x74*x77*(P[0][0].z*x20 - P[0][1].z*x61 - P[0][2].z*x56 - P[0][3].z*x22 - P[1][0].z*x36 + P[1][1].z*x73 + P[1][2].z*x71 + P[1][3].z*x38 - P[2][0].z*x30 + P[2][1].z*x72 + P[2][2].z*x70 + P[2][3].z*x33 - P[3][0].z*x13 + P[3][1].z*x63 + P[3][2].z*x58 + P[3][3].z*x16) - x75*x77*(P[0][0].y*x20 - P[0][1].y*x61 - P[0][2].y*x56 - P[0][3].y*x22 - P[1][0].y*x36 + P[1][1].y*x73 + P[1][2].y*x71 + P[1][3].y*x38 - P[2][0].y*x30 + P[2][1].y*x72 + P[2][2].y*x70 + P[2][3].y*x33 - P[3][0].y*x13 + P[3][1].y*x63 + P[3][2].y*x58 + P[3][3].y*x16) - x76*x77*(P[0][0].x*x20 - P[0][1].x*x61 - P[0][2].x*x56 - P[0][3].x*x22 - P[1][0].x*x36 + P[1][1].x*x73 + P[1][2].x*x71 + P[1][3].x*x38 - P[2][0].x*x30 + P[2][1].x*x72 + P[2][2].x*x70 + P[2][3].x*x33 - P[3][0].x*x13 + P[3][1].x*x63 + P[3][2].x*x58 + P[3][3].x*x16)

def principle_direction_v_1(P, kp, u, v):
    x0 = v**3
    x1 = u**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**2
    x6 = 3*x5
    x7 = x0*x6
    x8 = 1 - v
    x9 = x8**3
    x10 = x2*x9
    x11 = 9*x1
    x12 = x8**2
    x13 = v*x12
    x14 = P[3][1].x*x13
    x15 = v**2
    x16 = x15*x8
    x17 = x11*x16
    x18 = x6*x9
    x19 = 9*x5
    x20 = P[0][1].x*x13
    x21 = x16*x19
    x22 = 6*u*x4 - x2
    x23 = x0*x22
    x24 = 3*u
    x25 = x24*(2*u - 2) + x6
    x26 = x0*x25
    x27 = x22*x9
    x28 = 3*x12
    x29 = v*x28
    x30 = x22*x29
    x31 = 3*x15
    x32 = x31*x8
    x33 = x22*x32
    x34 = x25*x9
    x35 = x25*x29
    x36 = x25*x32
    x37 = -P[0][0].x*x18 - P[0][2].x*x21 - P[0][3].x*x7 + P[1][0].x*x34 + P[1][1].x*x35 + P[1][2].x*x36 + P[1][3].x*x26 + P[2][0].x*x27 + P[2][1].x*x30 + P[2][2].x*x33 + P[2][3].x*x23 + P[3][0].x*x10 + P[3][2].x*x17 + P[3][3].x*x3 + x11*x14 - x19*x20
    x38 = x11*x13
    x39 = x13*x19
    x40 = -P[0][0].y*x18 - P[0][1].y*x39 - P[0][2].y*x21 - P[0][3].y*x7 + P[1][0].y*x34 + P[1][1].y*x35 + P[1][2].y*x36 + P[1][3].y*x26 + P[2][0].y*x27 + P[2][1].y*x30 + P[2][2].y*x33 + P[2][3].y*x23 + P[3][0].y*x10 + P[3][1].y*x38 + P[3][2].y*x17 + P[3][3].y*x3
    x41 = -P[0][0].z*x18 - P[0][1].z*x39 - P[0][2].z*x21 - P[0][3].z*x7 + P[1][0].z*x34 + P[1][1].z*x35 + P[1][2].z*x36 + P[1][3].z*x26 + P[2][0].z*x27 + P[2][1].z*x30 + P[2][2].z*x33 + P[2][3].z*x23 + P[3][0].z*x10 + P[3][1].z*x38 + P[3][2].z*x17 + P[3][3].z*x3
    x42 = 6*u
    x43 = x0*x42
    x44 = 6*x4
    x45 = x0*x44
    x46 = x24 - 2
    x47 = 6*x46
    x48 = x0*x47
    x49 = 1 - x24
    x50 = 6*x49
    x51 = x0*x50
    x52 = x42*x9
    x53 = 18*u
    x54 = x13*x53
    x55 = x16*x53
    x56 = x44*x9
    x57 = x47*x9
    x58 = x50*x9
    x59 = 18*x4
    x60 = x13*x59
    x61 = x16*x59
    x62 = 18*x46
    x63 = x13*x62
    x64 = x16*x62
    x65 = 18*x49
    x66 = x13*x65
    x67 = x16*x65
    x68 = u**3
    x69 = x31*x68
    x70 = x4**3
    x71 = x31*x70
    x72 = x28*x68
    x73 = u*x19
    x74 = x15*x73
    x75 = x11*x4
    x76 = x15*x75
    x77 = x28*x70
    x78 = x12*x73
    x79 = x12*x75
    x80 = 6*v*x8 - x31
    x81 = x68*x80
    x82 = x70*x80
    x83 = 3*v*(2*v - 2) + x28
    x84 = x68*x83
    x85 = u*x6
    x86 = x80*x85
    x87 = x2*x4
    x88 = x80*x87
    x89 = x70*x83
    x90 = x83*x85
    x91 = x83*x87
    x92 = -P[0][0].y*x77 + P[0][1].y*x89 + P[0][2].y*x82 + P[0][3].y*x71 - P[1][0].y*x78 + P[1][1].y*x90 + P[1][2].y*x86 + P[1][3].y*x74 - P[2][0].y*x79 + P[2][1].y*x91 + P[2][2].y*x88 + P[2][3].y*x76 - P[3][0].y*x72 + P[3][1].y*x84 + P[3][2].y*x81 + P[3][3].y*x69
    x93 = -P[0][0].x*x77 + P[0][1].x*x89 + P[0][2].x*x82 + P[0][3].x*x71 - P[1][0].x*x78 + P[1][1].x*x90 + P[1][2].x*x86 + P[1][3].x*x74 - P[2][0].x*x79 + P[2][1].x*x91 + P[2][2].x*x88 + P[2][3].x*x76 - P[3][0].x*x72 + P[3][1].x*x84 + P[3][2].x*x81 + P[3][3].x*x69
    x94 = x37*x92 - x40*x93
    x95 = -3*P[0][0].z*x12*x70 + P[0][1].z*x89 + P[0][2].z*x82 + P[0][3].z*x71 - 9*P[1][0].z*u*x12*x5 + P[1][1].z*x90 + P[1][2].z*x86 + P[1][3].z*x74 - 9*P[2][0].z*x1*x12*x4 + P[2][1].z*x91 + P[2][2].z*x88 + P[2][3].z*x76 - 3*P[3][0].z*x12*x68 + P[3][1].z*x84 + P[3][2].z*x81 + P[3][3].z*x69
    x96 = -x37*x95 + x41*x93
    x97 = x40*x95 - x41*x92
    x98 = 1/sqrt(x94**2 + x96**2 + x97**2)
    return kp*(x37**2 + x40**2 + x41**2) + x94*x98*(P[0][0].z*x56 + P[0][1].z*x60 + P[0][2].z*x61 + P[0][3].z*x45 + P[1][0].z*x57 + P[1][1].z*x63 + P[1][2].z*x64 + P[1][3].z*x48 + P[2][0].z*x58 + P[2][1].z*x66 + P[2][2].z*x67 + P[2][3].z*x51 + P[3][0].z*x52 + P[3][1].z*x54 + P[3][2].z*x55 + P[3][3].z*x43) + x96*x98*(P[0][0].y*x56 + P[0][1].y*x60 + P[0][2].y*x61 + P[0][3].y*x45 + P[1][0].y*x57 + P[1][1].y*x63 + P[1][2].y*x64 + P[1][3].y*x48 + P[2][0].y*x58 + P[2][1].y*x66 + P[2][2].y*x67 + P[2][3].y*x51 + P[3][0].y*x52 + P[3][1].y*x54 + P[3][2].y*x55 + P[3][3].y*x43) + x97*x98*(P[0][0].x*x56 + P[0][2].x*x61 + P[0][3].x*x45 + P[1][0].x*x57 + P[1][1].x*x63 + P[1][2].x*x64 + P[1][3].x*x48 + P[2][0].x*x58 + P[2][1].x*x66 + P[2][2].x*x67 + P[2][3].x*x51 + P[3][0].x*x52 + P[3][2].x*x55 + P[3][3].x*x43 + x14*x53 + x20*x59)

def principle_direction_u_2(P, kp, u, v):
    x0 = u**3
    x1 = v**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**3
    x6 = x2*x5
    x7 = 1 - v
    x8 = x7**2
    x9 = 3*x8
    x10 = x0*x9
    x11 = 9*x1
    x12 = x4**2
    x13 = u*x12
    x14 = P[1][3].x*x13
    x15 = u**2
    x16 = x15*x4
    x17 = x11*x16
    x18 = x5*x9
    x19 = 9*x8
    x20 = P[1][0].x*x13
    x21 = x16*x19
    x22 = 6*v*x7 - x2
    x23 = x0*x22
    x24 = x22*x5
    x25 = 3*v
    x26 = x25*(2*v - 2) + x9
    x27 = x0*x26
    x28 = 3*x12
    x29 = u*x28
    x30 = x22*x29
    x31 = 3*x15
    x32 = x31*x4
    x33 = x22*x32
    x34 = x26*x5
    x35 = x26*x29
    x36 = x26*x32
    x37 = -P[0][0].x*x18 + P[0][1].x*x34 + P[0][2].x*x24 + P[0][3].x*x6 + P[1][1].x*x35 + P[1][2].x*x30 - P[2][0].x*x21 + P[2][1].x*x36 + P[2][2].x*x33 + P[2][3].x*x17 - P[3][0].x*x10 + P[3][1].x*x27 + P[3][2].x*x23 + P[3][3].x*x3 + x11*x14 - x19*x20
    x38 = x11*x13
    x39 = x13*x19
    x40 = -P[0][0].y*x18 + P[0][1].y*x34 + P[0][2].y*x24 + P[0][3].y*x6 - P[1][0].y*x39 + P[1][1].y*x35 + P[1][2].y*x30 + P[1][3].y*x38 - P[2][0].y*x21 + P[2][1].y*x36 + P[2][2].y*x33 + P[2][3].y*x17 - P[3][0].y*x10 + P[3][1].y*x27 + P[3][2].y*x23 + P[3][3].y*x3
    x41 = -P[0][0].z*x18 + P[0][1].z*x34 + P[0][2].z*x24 + P[0][3].z*x6 - P[1][0].z*x39 + P[1][1].z*x35 + P[1][2].z*x30 + P[1][3].z*x38 - P[2][0].z*x21 + P[2][1].z*x36 + P[2][2].z*x33 + P[2][3].z*x17 - P[3][0].z*x10 + P[3][1].z*x27 + P[3][2].z*x23 + P[3][3].z*x3
    x42 = 6*x0
    x43 = v*x42
    x44 = 6*x5
    x45 = v*x44
    x46 = 6*x7
    x47 = x0*x46
    x48 = x25 - 2
    x49 = x42*x48
    x50 = 1 - x25
    x51 = x42*x50
    x52 = 18*x13
    x53 = v*x52
    x54 = 18*x16
    x55 = v*x54
    x56 = x46*x5
    x57 = x44*x48
    x58 = x44*x50
    x59 = x52*x7
    x60 = x48*x52
    x61 = x50*x52
    x62 = x54*x7
    x63 = x48*x54
    x64 = x50*x54
    x65 = v**3
    x66 = x31*x65
    x67 = x28*x65
    x68 = x7**3
    x69 = x31*x68
    x70 = v*x19
    x71 = x15*x70
    x72 = x11*x7
    x73 = x15*x72
    x74 = x28*x68
    x75 = x12*x70
    x76 = x12*x72
    x77 = 6*u*x4 - x31
    x78 = x65*x77
    x79 = 3*u*(2*u - 2) + x28
    x80 = x65*x79
    x81 = x68*x77
    x82 = v*x9
    x83 = x77*x82
    x84 = x2*x7
    x85 = x77*x84
    x86 = x68*x79
    x87 = x79*x82
    x88 = x79*x84
    x89 = -P[0][0].x*x74 - P[0][1].x*x75 - P[0][2].x*x76 - P[0][3].x*x67 + P[1][0].x*x86 + P[1][1].x*x87 + P[1][2].x*x88 + P[1][3].x*x80 + P[2][0].x*x81 + P[2][1].x*x83 + P[2][2].x*x85 + P[2][3].x*x78 + P[3][0].x*x69 + P[3][1].x*x71 + P[3][2].x*x73 + P[3][3].x*x66
    x90 = -P[0][0].y*x74 - P[0][1].y*x75 - P[0][2].y*x76 - P[0][3].y*x67 + P[1][0].y*x86 + P[1][1].y*x87 + P[1][2].y*x88 + P[1][3].y*x80 + P[2][0].y*x81 + P[2][1].y*x83 + P[2][2].y*x85 + P[2][3].y*x78 + P[3][0].y*x69 + P[3][1].y*x71 + P[3][2].y*x73 + P[3][3].y*x66
    x91 = -x37*x90 + x40*x89
    x92 = -P[0][0].z*x74 - P[0][1].z*x75 - P[0][2].z*x76 - P[0][3].z*x67 + P[1][0].z*x86 + P[1][1].z*x87 + P[1][2].z*x88 + P[1][3].z*x80 + P[2][0].z*x81 + P[2][1].z*x83 + P[2][2].z*x85 + P[2][3].z*x78 + P[3][0].z*x69 + P[3][1].z*x71 + P[3][2].z*x73 + P[3][3].z*x66
    x93 = x37*x92 - x41*x89
    x94 = -x40*x92 + x41*x90
    x95 = 1/sqrt(x91**2 + x93**2 + x94**2)
    return -kp*(x37**2 + x40**2 + x41**2) - x91*x95*(P[0][0].z*x56 + P[0][1].z*x57 + P[0][2].z*x58 + P[0][3].z*x45 + P[1][0].z*x59 + P[1][1].z*x60 + P[1][2].z*x61 + P[1][3].z*x53 + P[2][0].z*x62 + P[2][1].z*x63 + P[2][2].z*x64 + P[2][3].z*x55 + P[3][0].z*x47 + P[3][1].z*x49 + P[3][2].z*x51 + P[3][3].z*x43) - x93*x95*(P[0][0].y*x56 + P[0][1].y*x57 + P[0][2].y*x58 + P[0][3].y*x45 + P[1][0].y*x59 + P[1][1].y*x60 + P[1][2].y*x61 + P[1][3].y*x53 + P[2][0].y*x62 + P[2][1].y*x63 + P[2][2].y*x64 + P[2][3].y*x55 + P[3][0].y*x47 + P[3][1].y*x49 + P[3][2].y*x51 + P[3][3].y*x43) - x94*x95*(P[0][0].x*x56 + P[0][1].x*x57 + P[0][2].x*x58 + P[0][3].x*x45 + P[1][1].x*x60 + P[1][2].x*x61 + P[2][0].x*x62 + P[2][1].x*x63 + P[2][2].x*x64 + P[2][3].x*x55 + P[3][0].x*x47 + P[3][1].x*x49 + P[3][2].x*x51 + P[3][3].x*x43 + 18*v*x14 + 18*x20*x7)

def principle_direction_v_2(P, kp, u, v):
    x0 = v**3
    x1 = u**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**2
    x6 = 3*x5
    x7 = x0*x6
    x8 = 1 - v
    x9 = x8**3
    x10 = x2*x9
    x11 = x8**2
    x12 = 9*x1
    x13 = x11*x12
    x14 = v*x13
    x15 = v**2
    x16 = x12*x15
    x17 = x16*x8
    x18 = x6*x9
    x19 = 9*x5
    x20 = x11*x19
    x21 = v*x20
    x22 = x15*x19
    x23 = x22*x8
    x24 = 6*u*x4 - x2
    x25 = x0*x24
    x26 = 3*u*(2*u - 2) + x6
    x27 = x0*x26
    x28 = x24*x9
    x29 = 3*x11
    x30 = x24*x29
    x31 = v*x30
    x32 = 3*x15
    x33 = x24*x32
    x34 = x33*x8
    x35 = x26*x9
    x36 = x26*x29
    x37 = v*x36
    x38 = x26*x32
    x39 = x38*x8
    x40 = -P[0][0].x*x18 - P[0][1].x*x21 - P[0][2].x*x23 - P[0][3].x*x7 + P[1][0].x*x35 + P[1][1].x*x37 + P[1][2].x*x39 + P[1][3].x*x27 + P[2][0].x*x28 + P[2][1].x*x31 + P[2][2].x*x34 + P[2][3].x*x25 + P[3][0].x*x10 + P[3][1].x*x14 + P[3][2].x*x17 + P[3][3].x*x3
    x41 = u**3
    x42 = x32*x41
    x43 = x4**3
    x44 = x32*x43
    x45 = x29*x41
    x46 = u*x22
    x47 = x16*x4
    x48 = x29*x43
    x49 = u*x20
    x50 = x13*x4
    x51 = 6*v*x8 - x32
    x52 = x41*x51
    x53 = x43*x51
    x54 = 3*v*(2*v - 2) + x29
    x55 = x41*x54
    x56 = x51*x6
    x57 = u*x56
    x58 = x2*x51
    x59 = x4*x58
    x60 = x43*x54
    x61 = x54*x6
    x62 = u*x61
    x63 = x2*x54
    x64 = x4*x63
    x65 = -P[0][0].x*x48 + P[0][1].x*x60 + P[0][2].x*x53 + P[0][3].x*x44 - P[1][0].x*x49 + P[1][1].x*x62 + P[1][2].x*x57 + P[1][3].x*x46 - P[2][0].x*x50 + P[2][1].x*x64 + P[2][2].x*x59 + P[2][3].x*x47 - P[3][0].x*x45 + P[3][1].x*x55 + P[3][2].x*x52 + P[3][3].x*x42
    x66 = -P[0][0].y*x18 - P[0][1].y*x21 - P[0][2].y*x23 - P[0][3].y*x7 + P[1][0].y*x35 + P[1][1].y*x37 + P[1][2].y*x39 + P[1][3].y*x27 + P[2][0].y*x28 + P[2][1].y*x31 + P[2][2].y*x34 + P[2][3].y*x25 + P[3][0].y*x10 + P[3][1].y*x14 + P[3][2].y*x17 + P[3][3].y*x3
    x67 = -P[0][0].y*x48 + P[0][1].y*x60 + P[0][2].y*x53 + P[0][3].y*x44 - P[1][0].y*x49 + P[1][1].y*x62 + P[1][2].y*x57 + P[1][3].y*x46 - P[2][0].y*x50 + P[2][1].y*x64 + P[2][2].y*x59 + P[2][3].y*x47 - P[3][0].y*x45 + P[3][1].y*x55 + P[3][2].y*x52 + P[3][3].y*x42
    x68 = -P[0][0].z*x18 - P[0][1].z*x21 - P[0][2].z*x23 - P[0][3].z*x7 + P[1][0].z*x35 + P[1][1].z*x37 + P[1][2].z*x39 + P[1][3].z*x27 + P[2][0].z*x28 + P[2][1].z*x31 + P[2][2].z*x34 + P[2][3].z*x25 + P[3][0].z*x10 + P[3][1].z*x14 + P[3][2].z*x17 + P[3][3].z*x3
    x69 = -P[0][0].z*x48 + P[0][1].z*x60 + P[0][2].z*x53 + P[0][3].z*x44 - P[1][0].z*x49 + P[1][1].z*x62 + P[1][2].z*x57 + P[1][3].z*x46 - P[2][0].z*x50 + P[2][1].z*x64 + P[2][2].z*x59 + P[2][3].z*x47 - P[3][0].z*x45 + P[3][1].z*x55 + P[3][2].z*x52 + P[3][3].z*x42
    x70 = x24*x51
    x71 = x26*x51
    x72 = x24*x54
    x73 = x26*x54
    x74 = x40*x67 - x65*x66
    x75 = -x40*x69 + x65*x68
    x76 = x66*x69 - x67*x68
    x77 = 1/sqrt(x74**2 + x75**2 + x76**2)
    return kp*(x40*x65 + x66*x67 + x68*x69) + x74*x77*(P[0][0].z*x20 - P[0][1].z*x61 - P[0][2].z*x56 - P[0][3].z*x22 - P[1][0].z*x36 + P[1][1].z*x73 + P[1][2].z*x71 + P[1][3].z*x38 - P[2][0].z*x30 + P[2][1].z*x72 + P[2][2].z*x70 + P[2][3].z*x33 - P[3][0].z*x13 + P[3][1].z*x63 + P[3][2].z*x58 + P[3][3].z*x16) + x75*x77*(P[0][0].y*x20 - P[0][1].y*x61 - P[0][2].y*x56 - P[0][3].y*x22 - P[1][0].y*x36 + P[1][1].y*x73 + P[1][2].y*x71 + P[1][3].y*x38 - P[2][0].y*x30 + P[2][1].y*x72 + P[2][2].y*x70 + P[2][3].y*x33 - P[3][0].y*x13 + P[3][1].y*x63 + P[3][2].y*x58 + P[3][3].y*x16) + x76*x77*(P[0][0].x*x20 - P[0][1].x*x61 - P[0][2].x*x56 - P[0][3].x*x22 - P[1][0].x*x36 + P[1][1].x*x73 + P[1][2].x*x71 + P[1][3].x*x38 - P[2][0].x*x30 + P[2][1].x*x72 + P[2][2].x*x70 + P[2][3].x*x33 - P[3][0].x*x13 + P[3][1].x*x63 + P[3][2].x*x58 + P[3][3].x*x16)

def principle_direction_1_arc_length_scalar(P, kp, u, v):
    x0 = u**3
    x1 = v**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**3
    x6 = x2*x5
    x7 = 1 - v
    x8 = x7**2
    x9 = 3*x8
    x10 = x0*x9
    x11 = x4**2
    x12 = 9*x11
    x13 = x1*x12
    x14 = u*x13
    x15 = u**2
    x16 = 9*x15
    x17 = x1*x16
    x18 = x17*x4
    x19 = x5*x9
    x20 = x12*x8
    x21 = u*x20
    x22 = x16*x8
    x23 = x22*x4
    x24 = 6*v*x7 - x2
    x25 = x0*x24
    x26 = x24*x5
    x27 = 3*v*(2*v - 2) + x9
    x28 = x0*x27
    x29 = 3*x11
    x30 = x24*x29
    x31 = u*x30
    x32 = 3*x15
    x33 = x24*x32
    x34 = x33*x4
    x35 = x27*x5
    x36 = x27*x29
    x37 = u*x36
    x38 = x27*x32
    x39 = x38*x4
    x40 = -P[0][0].x*x19 + P[0][1].x*x35 + P[0][2].x*x26 + P[0][3].x*x6 - P[1][0].x*x21 + P[1][1].x*x37 + P[1][2].x*x31 + P[1][3].x*x14 - P[2][0].x*x23 + P[2][1].x*x39 + P[2][2].x*x34 + P[2][3].x*x18 - P[3][0].x*x10 + P[3][1].x*x28 + P[3][2].x*x25 + P[3][3].x*x3
    x41 = -P[0][0].y*x19 + P[0][1].y*x35 + P[0][2].y*x26 + P[0][3].y*x6 - P[1][0].y*x21 + P[1][1].y*x37 + P[1][2].y*x31 + P[1][3].y*x14 - P[2][0].y*x23 + P[2][1].y*x39 + P[2][2].y*x34 + P[2][3].y*x18 - P[3][0].y*x10 + P[3][1].y*x28 + P[3][2].y*x25 + P[3][3].y*x3
    x42 = -3*P[0][0].z*x5*x8 + P[0][1].z*x35 + P[0][2].z*x26 + P[0][3].z*x6 - 9*P[1][0].z*u*x11*x8 + P[1][1].z*x37 + P[1][2].z*x31 + P[1][3].z*x14 - 9*P[2][0].z*x15*x4*x8 + P[2][1].z*x39 + P[2][2].z*x34 + P[2][3].z*x18 - 3*P[3][0].z*x0*x8 + P[3][1].z*x28 + P[3][2].z*x25 + P[3][3].z*x3
    x43 = v**3
    x44 = x32*x43
    x45 = x29*x43
    x46 = x7**3
    x47 = x32*x46
    x48 = v*x22
    x49 = x17*x7
    x50 = x29*x46
    x51 = v*x20
    x52 = x13*x7
    x53 = 6*u*x4 - x32
    x54 = x43*x53
    x55 = 3*u
    x56 = x29 + x55*(2*u - 2)
    x57 = x43*x56
    x58 = x46*x53
    x59 = x53*x9
    x60 = v*x59
    x61 = x2*x53
    x62 = x61*x7
    x63 = x46*x56
    x64 = x56*x9
    x65 = v*x64
    x66 = x2*x56
    x67 = x66*x7
    x68 = -P[0][0].x*x50 - P[0][1].x*x51 - P[0][2].x*x52 - P[0][3].x*x45 + P[1][0].x*x63 + P[1][1].x*x65 + P[1][2].x*x67 + P[1][3].x*x57 + P[2][0].x*x58 + P[2][1].x*x60 + P[2][2].x*x62 + P[2][3].x*x54 + P[3][0].x*x47 + P[3][1].x*x48 + P[3][2].x*x49 + P[3][3].x*x44
    x69 = -P[0][0].y*x50 - P[0][1].y*x51 - P[0][2].y*x52 - P[0][3].y*x45 + P[1][0].y*x63 + P[1][1].y*x65 + P[1][2].y*x67 + P[1][3].y*x57 + P[2][0].y*x58 + P[2][1].y*x60 + P[2][2].y*x62 + P[2][3].y*x54 + P[3][0].y*x47 + P[3][1].y*x48 + P[3][2].y*x49 + P[3][3].y*x44
    x70 = -P[0][0].z*x50 - P[0][1].z*x51 - P[0][2].z*x52 - P[0][3].z*x45 + P[1][0].z*x63 + P[1][1].z*x65 + P[1][2].z*x67 + P[1][3].z*x57 + P[2][0].z*x58 + P[2][1].z*x60 + P[2][2].z*x62 + P[2][3].z*x54 + P[3][0].z*x47 + P[3][1].z*x48 + P[3][2].z*x49 + P[3][3].z*x44
    x71 = x68**2 + x69**2 + x70**2
    x72 = 6*u
    x73 = x43*x72
    x74 = 6*x4
    x75 = x43*x74
    x76 = x55 - 2
    x77 = 6*x76
    x78 = x43*x77
    x79 = 1 - x55
    x80 = 6*x79
    x81 = x43*x80
    x82 = x46*x72
    x83 = v*x8
    x84 = 18*u
    x85 = x83*x84
    x86 = x1*x7
    x87 = x84*x86
    x88 = x46*x74
    x89 = x46*x77
    x90 = x46*x80
    x91 = 18*x4
    x92 = x83*x91
    x93 = x86*x91
    x94 = 18*x76
    x95 = x83*x94
    x96 = x86*x94
    x97 = 18*x79
    x98 = x83*x97
    x99 = x86*x97
    x100 = -x40*x69 + x41*x68
    x101 = x40*x70 - x42*x68
    x102 = -x41*x70 + x42*x69
    x103 = 1/sqrt(x100**2 + x101**2 + x102**2)
    x104 = x100*x103
    x105 = x101*x103
    x106 = x102*x103
    x107 = kp*x71 + x104*(P[0][0].z*x88 + P[0][1].z*x92 + P[0][2].z*x93 + P[0][3].z*x75 + P[1][0].z*x89 + P[1][1].z*x95 + P[1][2].z*x96 + P[1][3].z*x78 + P[2][0].z*x90 + P[2][1].z*x98 + P[2][2].z*x99 + P[2][3].z*x81 + P[3][0].z*x82 + P[3][1].z*x85 + P[3][2].z*x87 + P[3][3].z*x73) + x105*(P[0][0].y*x88 + P[0][1].y*x92 + P[0][2].y*x93 + P[0][3].y*x75 + P[1][0].y*x89 + P[1][1].y*x95 + P[1][2].y*x96 + P[1][3].y*x78 + P[2][0].y*x90 + P[2][1].y*x98 + P[2][2].y*x99 + P[2][3].y*x81 + P[3][0].y*x82 + P[3][1].y*x85 + P[3][2].y*x87 + P[3][3].y*x73) + x106*(P[0][0].x*x88 + P[0][1].x*x92 + P[0][2].x*x93 + P[0][3].x*x75 + P[1][0].x*x89 + P[1][1].x*x95 + P[1][2].x*x96 + P[1][3].x*x78 + P[2][0].x*x90 + P[2][1].x*x98 + P[2][2].x*x99 + P[2][3].x*x81 + P[3][0].x*x82 + P[3][1].x*x85 + P[3][2].x*x87 + P[3][3].x*x73)
    x108 = x40*x68 + x41*x69 + x42*x70
    x109 = x24*x53
    x110 = x24*x56
    x111 = x27*x53
    x112 = x27*x56
    x113 = kp*x108 + x104*(P[0][0].z*x20 - P[0][1].z*x36 - P[0][2].z*x30 - P[0][3].z*x13 - P[1][0].z*x64 + P[1][1].z*x112 + P[1][2].z*x110 + P[1][3].z*x66 - P[2][0].z*x59 + P[2][1].z*x111 + P[2][2].z*x109 + P[2][3].z*x61 - P[3][0].z*x22 + P[3][1].z*x38 + P[3][2].z*x33 + P[3][3].z*x17) + x105*(P[0][0].y*x20 - P[0][1].y*x36 - P[0][2].y*x30 - P[0][3].y*x13 - P[1][0].y*x64 + P[1][1].y*x112 + P[1][2].y*x110 + P[1][3].y*x66 - P[2][0].y*x59 + P[2][1].y*x111 + P[2][2].y*x109 + P[2][3].y*x61 - P[3][0].y*x22 + P[3][1].y*x38 + P[3][2].y*x33 + P[3][3].y*x17) + x106*(P[0][0].x*x20 - P[0][1].x*x36 - P[0][2].x*x30 - P[0][3].x*x13 - P[1][0].x*x64 + P[1][1].x*x112 + P[1][2].x*x110 + P[1][3].x*x66 - P[2][0].x*x59 + P[2][1].x*x111 + P[2][2].x*x109 + P[2][3].x*x61 - P[3][0].x*x22 + P[3][1].x*x38 + P[3][2].x*x33 + P[3][3].x*x17)
    return 1/sqrt(x107**2*(x40**2 + x41**2 + x42**2) - 2*x107*x108*x113 + x113**2*x71)

def principle_direction_2_arc_length_scalar(P, kp, u, v):
    x0 = v**3
    x1 = u**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**2
    x6 = 3*x5
    x7 = x0*x6
    x8 = 1 - v
    x9 = x8**3
    x10 = x2*x9
    x11 = x8**2
    x12 = 9*x1
    x13 = x11*x12
    x14 = v*x13
    x15 = v**2
    x16 = x12*x15
    x17 = x16*x8
    x18 = x6*x9
    x19 = 9*x5
    x20 = x11*x19
    x21 = v*x20
    x22 = x15*x19
    x23 = x22*x8
    x24 = 6*u*x4 - x2
    x25 = x0*x24
    x26 = 3*u*(2*u - 2) + x6
    x27 = x0*x26
    x28 = x24*x9
    x29 = 3*x11
    x30 = x24*x29
    x31 = v*x30
    x32 = 3*x15
    x33 = x24*x32
    x34 = x33*x8
    x35 = x26*x9
    x36 = x26*x29
    x37 = v*x36
    x38 = x26*x32
    x39 = x38*x8
    x40 = -P[0][0].x*x18 - P[0][1].x*x21 - P[0][2].x*x23 - P[0][3].x*x7 + P[1][0].x*x35 + P[1][1].x*x37 + P[1][2].x*x39 + P[1][3].x*x27 + P[2][0].x*x28 + P[2][1].x*x31 + P[2][2].x*x34 + P[2][3].x*x25 + P[3][0].x*x10 + P[3][1].x*x14 + P[3][2].x*x17 + P[3][3].x*x3
    x41 = -P[0][0].y*x18 - P[0][1].y*x21 - P[0][2].y*x23 - P[0][3].y*x7 + P[1][0].y*x35 + P[1][1].y*x37 + P[1][2].y*x39 + P[1][3].y*x27 + P[2][0].y*x28 + P[2][1].y*x31 + P[2][2].y*x34 + P[2][3].y*x25 + P[3][0].y*x10 + P[3][1].y*x14 + P[3][2].y*x17 + P[3][3].y*x3
    x42 = -P[0][0].z*x18 - P[0][1].z*x21 - P[0][2].z*x23 - P[0][3].z*x7 + P[1][0].z*x35 + P[1][1].z*x37 + P[1][2].z*x39 + P[1][3].z*x27 + P[2][0].z*x28 + P[2][1].z*x31 + P[2][2].z*x34 + P[2][3].z*x25 + P[3][0].z*x10 + P[3][1].z*x14 + P[3][2].z*x17 + P[3][3].z*x3
    x43 = u**3
    x44 = x32*x43
    x45 = x4**3
    x46 = x32*x45
    x47 = x29*x43
    x48 = u*x22
    x49 = x16*x4
    x50 = x29*x45
    x51 = u*x20
    x52 = x13*x4
    x53 = 6*v*x8 - x32
    x54 = x43*x53
    x55 = x45*x53
    x56 = 3*v
    x57 = x29 + x56*(2*v - 2)
    x58 = x43*x57
    x59 = x53*x6
    x60 = u*x59
    x61 = x2*x53
    x62 = x4*x61
    x63 = x45*x57
    x64 = x57*x6
    x65 = u*x64
    x66 = x2*x57
    x67 = x4*x66
    x68 = -P[0][0].x*x50 + P[0][1].x*x63 + P[0][2].x*x55 + P[0][3].x*x46 - P[1][0].x*x51 + P[1][1].x*x65 + P[1][2].x*x60 + P[1][3].x*x48 - P[2][0].x*x52 + P[2][1].x*x67 + P[2][2].x*x62 + P[2][3].x*x49 - P[3][0].x*x47 + P[3][1].x*x58 + P[3][2].x*x54 + P[3][3].x*x44
    x69 = -P[0][0].y*x50 + P[0][1].y*x63 + P[0][2].y*x55 + P[0][3].y*x46 - P[1][0].y*x51 + P[1][1].y*x65 + P[1][2].y*x60 + P[1][3].y*x48 - P[2][0].y*x52 + P[2][1].y*x67 + P[2][2].y*x62 + P[2][3].y*x49 - P[3][0].y*x47 + P[3][1].y*x58 + P[3][2].y*x54 + P[3][3].y*x44
    x70 = -P[0][0].z*x50 + P[0][1].z*x63 + P[0][2].z*x55 + P[0][3].z*x46 - P[1][0].z*x51 + P[1][1].z*x65 + P[1][2].z*x60 + P[1][3].z*x48 - P[2][0].z*x52 + P[2][1].z*x67 + P[2][2].z*x62 + P[2][3].z*x49 - P[3][0].z*x47 + P[3][1].z*x58 + P[3][2].z*x54 + P[3][3].z*x44
    x71 = x68**2 + x69**2 + x70**2
    x72 = 6*x43
    x73 = v*x72
    x74 = 6*x45
    x75 = v*x74
    x76 = 6*x8
    x77 = x43*x76
    x78 = x56 - 2
    x79 = x72*x78
    x80 = 1 - x56
    x81 = x72*x80
    x82 = u*x5
    x83 = 18*x82
    x84 = v*x83
    x85 = x1*x4
    x86 = 18*x85
    x87 = v*x86
    x88 = x45*x76
    x89 = x74*x78
    x90 = x74*x80
    x91 = 18*x8
    x92 = x82*x91
    x93 = x78*x83
    x94 = x80*x83
    x95 = x85*x91
    x96 = x78*x86
    x97 = x80*x86
    x98 = x40*x69 - x41*x68
    x99 = -x40*x70 + x42*x68
    x100 = x41*x70 - x42*x69
    x101 = 1/sqrt(x100**2 + x98**2 + x99**2)
    x102 = x101*x98
    x103 = x101*x99
    x104 = x100*x101
    x105 = kp*x71 + x102*(P[0][0].z*x88 + P[0][1].z*x89 + P[0][2].z*x90 + P[0][3].z*x75 + P[1][0].z*x92 + P[1][1].z*x93 + P[1][2].z*x94 + P[1][3].z*x84 + P[2][0].z*x95 + P[2][1].z*x96 + P[2][2].z*x97 + P[2][3].z*x87 + P[3][0].z*x77 + P[3][1].z*x79 + P[3][2].z*x81 + P[3][3].z*x73) + x103*(P[0][0].y*x88 + P[0][1].y*x89 + P[0][2].y*x90 + P[0][3].y*x75 + P[1][0].y*x92 + P[1][1].y*x93 + P[1][2].y*x94 + P[1][3].y*x84 + P[2][0].y*x95 + P[2][1].y*x96 + P[2][2].y*x97 + P[2][3].y*x87 + P[3][0].y*x77 + P[3][1].y*x79 + P[3][2].y*x81 + P[3][3].y*x73) + x104*(P[0][0].x*x88 + P[0][1].x*x89 + P[0][2].x*x90 + P[0][3].x*x75 + P[1][0].x*x92 + P[1][1].x*x93 + P[1][2].x*x94 + P[1][3].x*x84 + P[2][0].x*x95 + P[2][1].x*x96 + P[2][2].x*x97 + P[2][3].x*x87 + P[3][0].x*x77 + P[3][1].x*x79 + P[3][2].x*x81 + P[3][3].x*x73)
    x106 = x40*x68 + x41*x69 + x42*x70
    x107 = x24*x53
    x108 = x26*x53
    x109 = x24*x57
    x110 = x26*x57
    x111 = kp*x106 + x102*(P[0][0].z*x20 - P[0][1].z*x64 - P[0][2].z*x59 - P[0][3].z*x22 - P[1][0].z*x36 + P[1][1].z*x110 + P[1][2].z*x108 + P[1][3].z*x38 - P[2][0].z*x30 + P[2][1].z*x109 + P[2][2].z*x107 + P[2][3].z*x33 - P[3][0].z*x13 + P[3][1].z*x66 + P[3][2].z*x61 + P[3][3].z*x16) + x103*(P[0][0].y*x20 - P[0][1].y*x64 - P[0][2].y*x59 - P[0][3].y*x22 - P[1][0].y*x36 + P[1][1].y*x110 + P[1][2].y*x108 + P[1][3].y*x38 - P[2][0].y*x30 + P[2][1].y*x109 + P[2][2].y*x107 + P[2][3].y*x33 - P[3][0].y*x13 + P[3][1].y*x66 + P[3][2].y*x61 + P[3][3].y*x16) + x104*(P[0][0].x*x20 - P[0][1].x*x64 - P[0][2].x*x59 - P[0][3].x*x22 - P[1][0].x*x36 + P[1][1].x*x110 + P[1][2].x*x108 + P[1][3].x*x38 - P[2][0].x*x30 + P[2][1].x*x109 + P[2][2].x*x107 + P[2][3].x*x33 - P[3][0].x*x13 + P[3][1].x*x66 + P[3][2].x*x61 + P[3][3].x*x16)
    return 1/sqrt(x105**2*(x40**2 + x41**2 + x42**2) - 2*x105*x106*x111 + x111**2*x71)

def orthogonal_verification_value(P, u, v, u_1, v_1, u_2, v_2):
    x0 = v**3
    x1 = u**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = 1 - u
    x5 = x4**2
    x6 = 3*x5
    x7 = x0*x6
    x8 = 1 - v
    x9 = x8**3
    x10 = x2*x9
    x11 = x8**2
    x12 = 9*x11
    x13 = v*x12
    x14 = x1*x13
    x15 = v**2
    x16 = 9*x15
    x17 = x16*x8
    x18 = x1*x17
    x19 = x6*x9
    x20 = x13*x5
    x21 = x17*x5
    x22 = 6*u*x4 - x2
    x23 = x0*x22
    x24 = 3*u*(2*u - 2) + x6
    x25 = x0*x24
    x26 = x22*x9
    x27 = 3*x11
    x28 = v*x27
    x29 = x22*x28
    x30 = 3*x15
    x31 = x30*x8
    x32 = x22*x31
    x33 = x24*x9
    x34 = x24*x28
    x35 = x24*x31
    x36 = -P[0][0].x*x19 - P[0][1].x*x20 - P[0][2].x*x21 - P[0][3].x*x7 + P[1][0].x*x33 + P[1][1].x*x34 + P[1][2].x*x35 + P[1][3].x*x25 + P[2][0].x*x26 + P[2][1].x*x29 + P[2][2].x*x32 + P[2][3].x*x23 + P[3][0].x*x10 + P[3][1].x*x14 + P[3][2].x*x18 + P[3][3].x*x3
    x37 = -P[0][0].y*x19 - P[0][1].y*x20 - P[0][2].y*x21 - P[0][3].y*x7 + P[1][0].y*x33 + P[1][1].y*x34 + P[1][2].y*x35 + P[1][3].y*x25 + P[2][0].y*x26 + P[2][1].y*x29 + P[2][2].y*x32 + P[2][3].y*x23 + P[3][0].y*x10 + P[3][1].y*x14 + P[3][2].y*x18 + P[3][3].y*x3
    x38 = -P[0][0].z*x19 - P[0][1].z*x20 - P[0][2].z*x21 - P[0][3].z*x7 + P[1][0].z*x33 + P[1][1].z*x34 + P[1][2].z*x35 + P[1][3].z*x25 + P[2][0].z*x26 + P[2][1].z*x29 + P[2][2].z*x32 + P[2][3].z*x23 + P[3][0].z*x10 + P[3][1].z*x14 + P[3][2].z*x18 + P[3][3].z*x3
    x39 = u**3
    x40 = x30*x39
    x41 = x4**3
    x42 = x30*x41
    x43 = x27*x39
    x44 = u*x5
    x45 = x16*x44
    x46 = x1*x4
    x47 = x16*x46
    x48 = x27*x41
    x49 = x12*x44
    x50 = x12*x46
    x51 = 6*v*x8 - x30
    x52 = x39*x51
    x53 = x41*x51
    x54 = 3*v*(2*v - 2) + x27
    x55 = x39*x54
    x56 = u*x6
    x57 = x51*x56
    x58 = x2*x4
    x59 = x51*x58
    x60 = x41*x54
    x61 = x54*x56
    x62 = x54*x58
    x63 = -P[0][0].x*x48 + P[0][1].x*x60 + P[0][2].x*x53 + P[0][3].x*x42 - P[1][0].x*x49 + P[1][1].x*x61 + P[1][2].x*x57 + P[1][3].x*x45 - P[2][0].x*x50 + P[2][1].x*x62 + P[2][2].x*x59 + P[2][3].x*x47 - P[3][0].x*x43 + P[3][1].x*x55 + P[3][2].x*x52 + P[3][3].x*x40
    x64 = -P[0][0].y*x48 + P[0][1].y*x60 + P[0][2].y*x53 + P[0][3].y*x42 - P[1][0].y*x49 + P[1][1].y*x61 + P[1][2].y*x57 + P[1][3].y*x45 - P[2][0].y*x50 + P[2][1].y*x62 + P[2][2].y*x59 + P[2][3].y*x47 - P[3][0].y*x43 + P[3][1].y*x55 + P[3][2].y*x52 + P[3][3].y*x40
    x65 = -P[0][0].z*x48 + P[0][1].z*x60 + P[0][2].z*x53 + P[0][3].z*x42 - P[1][0].z*x49 + P[1][1].z*x61 + P[1][2].z*x57 + P[1][3].z*x45 - P[2][0].z*x50 + P[2][1].z*x62 + P[2][2].z*x59 + P[2][3].z*x47 - P[3][0].z*x43 + P[3][1].z*x55 + P[3][2].z*x52 + P[3][3].z*x40
    return u_1*u_2*(x36**2 + x37**2 + x38**2) + v_1*v_2*(x63**2 + x64**2 + x65**2) + (u_1*v_2 + u_2*v_1)*(x36*x63 + x37*x64 + x38*x65)

def principle_curvature_switch_condition(P, kp, u, v):
    x0 = v**3
    x1 = u**2
    x2 = 3*x1
    x3 = x0*x2
    x4 = u - 1
    x5 = x4**2
    x6 = 3*x5
    x7 = x0*x6
    x8 = v - 1
    x9 = x8**3
    x10 = x2*x9
    x11 = x8**2
    x12 = v*x11
    x13 = 9*x1
    x14 = x12*x13
    x15 = v**2
    x16 = x15*x8
    x17 = P[3][2].x*x16
    x18 = x6*x9
    x19 = 9*x5
    x20 = P[0][1].x*x12
    x21 = x16*x19
    x22 = 6*x4
    x23 = u*x22 + x2
    x24 = x0*x23
    x25 = x23*x9
    x26 = 3*u
    x27 = x26*(2*u - 2) + x6
    x28 = x0*x27
    x29 = 3*x11
    x30 = v*x29
    x31 = x23*x30
    x32 = 3*x15
    x33 = x32*x8
    x34 = x23*x33
    x35 = x27*x9
    x36 = x27*x30
    x37 = x27*x33
    x38 = P[0][0].x*x18 + P[0][2].x*x21 - P[0][3].x*x7 - P[1][0].x*x35 + P[1][1].x*x36 - P[1][2].x*x37 + P[1][3].x*x28 + P[2][0].x*x25 - P[2][1].x*x31 + P[2][2].x*x34 - P[2][3].x*x24 - P[3][0].x*x10 + P[3][1].x*x14 + P[3][3].x*x3 - x13*x17 - x19*x20
    x39 = x13*x16
    x40 = x12*x19
    x41 = P[0][0].y*x18 - P[0][1].y*x40 + P[0][2].y*x21 - P[0][3].y*x7 - P[1][0].y*x35 + P[1][1].y*x36 - P[1][2].y*x37 + P[1][3].y*x28 + P[2][0].y*x25 - P[2][1].y*x31 + P[2][2].y*x34 - P[2][3].y*x24 - P[3][0].y*x10 + P[3][1].y*x14 - P[3][2].y*x39 + P[3][3].y*x3
    x42 = P[0][0].z*x18 - P[0][1].z*x40 + P[0][2].z*x21 - P[0][3].z*x7 - P[1][0].z*x35 + P[1][1].z*x36 - P[1][2].z*x37 + P[1][3].z*x28 + P[2][0].z*x25 - P[2][1].z*x31 + P[2][2].z*x34 - P[2][3].z*x24 - P[3][0].z*x10 + P[3][1].z*x14 - P[3][2].z*x39 + P[3][3].z*x3
    x43 = 6*x0
    x44 = u*x43
    x45 = x0*x22
    x46 = 6*x9
    x47 = u*x46
    x48 = 18*x12
    x49 = u*x48
    x50 = 18*x16
    x51 = u*x50
    x52 = x22*x9
    x53 = x26 - 2
    x54 = x43*x53
    x55 = x26 - 1
    x56 = x43*x55
    x57 = x4*x48
    x58 = x4*x50
    x59 = x46*x53
    x60 = x46*x55
    x61 = x48*x53
    x62 = x50*x53
    x63 = x48*x55
    x64 = x50*x55
    x65 = u**3
    x66 = x32*x65
    x67 = x4**3
    x68 = x32*x67
    x69 = x29*x65
    x70 = u*x19
    x71 = x15*x70
    x72 = x13*x4
    x73 = x15*x72
    x74 = x29*x67
    x75 = x11*x70
    x76 = x11*x72
    x77 = 6*v
    x78 = x32 + x77*x8
    x79 = x65*x78
    x80 = x67*x78
    x81 = 3*v
    x82 = x29 + x81*(2*v - 2)
    x83 = x65*x82
    x84 = u*x6
    x85 = x78*x84
    x86 = x2*x4
    x87 = x78*x86
    x88 = x67*x82
    x89 = x82*x84
    x90 = x82*x86
    x91 = P[0][0].y*x74 - P[0][1].y*x88 + P[0][2].y*x80 - P[0][3].y*x68 - P[1][0].y*x75 + P[1][1].y*x89 - P[1][2].y*x85 + P[1][3].y*x71 + P[2][0].y*x76 - P[2][1].y*x90 + P[2][2].y*x87 - P[2][3].y*x73 - P[3][0].y*x69 + P[3][1].y*x83 - P[3][2].y*x79 + P[3][3].y*x66
    x92 = P[0][0].x*x74 - P[0][1].x*x88 + P[0][2].x*x80 - P[0][3].x*x68 - P[1][0].x*x75 + P[1][1].x*x89 - P[1][2].x*x85 + P[1][3].x*x71 + P[2][0].x*x76 - P[2][1].x*x90 + P[2][2].x*x87 - P[2][3].x*x73 - P[3][0].x*x69 + P[3][1].x*x83 - P[3][2].x*x79 + P[3][3].x*x66
    x93 = x38*x91 - x41*x92
    x94 = P[0][0].z*x74 - P[0][1].z*x88 + P[0][2].z*x80 - P[0][3].z*x68 - P[1][0].z*x75 + P[1][1].z*x89 - P[1][2].z*x85 + P[1][3].z*x71 + P[2][0].z*x76 - P[2][1].z*x90 + P[2][2].z*x87 - P[2][3].z*x73 - P[3][0].z*x69 + P[3][1].z*x83 - P[3][2].z*x79 + P[3][3].z*x66
    x95 = x38*x94 - x42*x92
    x96 = x41*x94 - x42*x91
    x97 = 1/sqrt(x93**2 + x95**2 + x96**2)
    x98 = x93*x97
    x99 = 18*u
    x100 = 18*x4
    x101 = x96*x97
    x102 = x95*x97
    x103 = x65*x77
    x104 = x67*x77
    x105 = 6*x65
    x106 = x105*x8
    x107 = x5*x99
    x108 = v*x107
    x109 = x1*x100
    x110 = v*x109
    x111 = 6*x67
    x112 = x111*x8
    x113 = x81 - 2
    x114 = x105*x113
    x115 = x81 - 1
    x116 = x105*x115
    x117 = x107*x8
    x118 = x109*x8
    x119 = x111*x113
    x120 = x111*x115
    x121 = x107*x113
    x122 = x107*x115
    x123 = x109*x113
    x124 = x109*x115
    return greater_equal(abs(kp*(x38**2 + x41**2 + x42**2) + x101*(P[0][0].x*x52 + P[0][2].x*x58 - P[0][3].x*x45 - P[1][0].x*x59 + P[1][1].x*x61 - P[1][2].x*x62 + P[1][3].x*x54 + P[2][0].x*x60 - P[2][1].x*x63 + P[2][2].x*x64 - P[2][3].x*x56 - P[3][0].x*x47 + P[3][1].x*x49 + P[3][3].x*x44 - x100*x20 - x17*x99) - x102*(P[0][0].y*x52 - P[0][1].y*x57 + P[0][2].y*x58 - P[0][3].y*x45 - P[1][0].y*x59 + P[1][1].y*x61 - P[1][2].y*x62 + P[1][3].y*x54 + P[2][0].y*x60 - P[2][1].y*x63 + P[2][2].y*x64 - P[2][3].y*x56 - P[3][0].y*x47 + P[3][1].y*x49 - P[3][2].y*x51 + P[3][3].y*x44) + x98*(P[0][0].z*x52 - P[0][1].z*x57 + P[0][2].z*x58 - P[0][3].z*x45 - P[1][0].z*x59 + P[1][1].z*x61 - P[1][2].z*x62 + P[1][3].z*x54 + P[2][0].z*x60 - P[2][1].z*x63 + P[2][2].z*x64 - P[2][3].z*x56 - P[3][0].z*x47 + P[3][1].z*x49 - P[3][2].z*x51 + P[3][3].z*x44)), abs(kp*(x91**2 + x92**2 + x94**2) + x101*(P[0][0].x*x112 - P[0][1].x*x119 + P[0][2].x*x120 - P[0][3].x*x104 - P[1][0].x*x117 + P[1][1].x*x121 - P[1][2].x*x122 + P[1][3].x*x108 + P[2][0].x*x118 - P[2][1].x*x123 + P[2][2].x*x124 - P[2][3].x*x110 - P[3][0].x*x106 + P[3][1].x*x114 - P[3][2].x*x116 + P[3][3].x*x103) - x102*(P[0][0].y*x112 - P[0][1].y*x119 + P[0][2].y*x120 - P[0][3].y*x104 - P[1][0].y*x117 + P[1][1].y*x121 - P[1][2].y*x122 + P[1][3].y*x108 + P[2][0].y*x118 - P[2][1].y*x123 + P[2][2].y*x124 - P[2][3].y*x110 - P[3][0].y*x106 + P[3][1].y*x114 - P[3][2].y*x116 + P[3][3].y*x103) + x98*(P[0][0].z*x112 - P[0][1].z*x119 + P[0][2].z*x120 - P[0][3].z*x104 - P[1][0].z*x117 + P[1][1].z*x121 - P[1][2].z*x122 + P[1][3].z*x108 + P[2][0].z*x118 - P[2][1].z*x123 + P[2][2].z*x124 - P[2][3].z*x110 - P[3][0].z*x106 + P[3][1].z*x114 - P[3][2].z*x116 + P[3][3].z*x103)))